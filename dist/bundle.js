(()=>{"use strict";class e{constructor(){this.turn=!0,this.position=this.position}autoPlay(e){return e[Math.floor(100*Math.random())]}}class t{constructor(e,t,r){this.length=e,this.hits=[],this.position=r||[],this.column=t||[]}hit(e){this.hits.push(e)}isSunk(){return this.length===this.hits.length}}const r=(e,t,r,l)=>{const o=document.querySelector(t);e.board.forEach((e=>{e.forEach((e=>{const t=document.createElement("div");t.classList.add(r),t.classList.add(l),t.setAttribute("value",e),o.appendChild(t),t.value=e,t.textContent=e}))}))},l=(e,t,r,l)=>{o(t,r);const a=document.querySelector(`#${t}`);e.board.forEach((e=>{e.forEach((e=>{const t=document.createElement("div");t.classList.add(r),t.classList.add(l),t.setAttribute("value",e),a.appendChild(t),t.value=e,t.textContent=e}))}))},o=(e,t)=>{const r=document.querySelector(`#${e}`);document.querySelectorAll(`.${t}`).forEach((e=>{r.removeChild(e)}))},a=(e,t,r)=>{let l=[6,7,8,9],o=[7,8,9],a=[8,9],n=[9];if(1===r)switch(!0){case 5===e.length&&l.includes(t.target.value%10):case 4===e.length&&o.includes(t.target.value%10):case 3===e.length&&a.includes(t.target.value%10):case 2===e.length&&n.includes(t.target.value%10):return!0}if(10===r)switch(!0){case 5===e.length&&l.includes(Math.floor(t.target.value/10)):case 4===e.length&&o.includes(Math.floor(t.target.value/10)):case 3===e.length&&a.includes(Math.floor(t.target.value/10)):case 2===e.length&&n.includes(Math.floor(t.target.value/10)):return!0}},n=(e,t,r,l)=>{let o=[];if(1!==e.length){for(let n=0;n<=(e.length-1)*l;n+=l){if(a(e,t,l))return;if(5===e.length&&t.target.value%10==6)return;if(t.target.value+n=="x0")return;if(null===document.querySelector(`div[value="${t.target.value+n}"]`))return;if(t.target.value+n=="x0")return;document.querySelector(`div[value="${t.target.value+n}"]`).style.backgroundColor=r,o.push(t.target.value+n)}return o}};let i=!0,c="horizontal",s=1;const u=document.querySelector("#rotate"),d=(e,r,o)=>{let a=document.querySelectorAll(`.player-grids.${c}`);const u=new t(r,[0,0,0],[1,2,3]);if(3===r&&i&&(r+=1,i=!1),r<=1)return console.log("am i ever here????"),console.log(e),console.log(o),h(o,e),void(e.allow=!0);a.forEach((t=>t.addEventListener("mouseover",(o=>{n(u,o,"blue",s),t.addEventListener("click",(t=>{u.position=n(u,t,"gray",s),u.column=(e=>{let t=[];for(let r=0;r<=e.length-1;r++)e.position[r]&&t.push(Math.floor(e.position[r]/10));return t})(u),e.placeShip(u),l(e,"primary-container","player-grids",c),Array.from(document.querySelectorAll(".player-grids")).filter((e=>"x"===e.value)).forEach((e=>e.style.backgroundColor="transparent")),d(e,r-1)}))})))),a.forEach((e=>e.addEventListener("mouseout",(e=>{n(u,e,"gray",s)}))))},h=(t,r)=>{let l,o,a;const n=document.querySelectorAll(".player-grids");document.querySelectorAll(".ai-grids").forEach((i=>i.addEventListener("click",(c=>{const s=c.target.value;l=new e,o=l.autoPlay(n),a=o.value,"x"===s?(t.recieveAttack(s),i.style.backgroundColor="red",g(o,a,r)):(i.style.backgroundColor="green",g(o,a,r))}))))},g=(e,t,r)=>{e.addEventListener("click",(l=>{const o=l.target.value;"x"===t?(r.recieveAttack(t),e.style.backgroundColor="red",r.recieveAttack(o),console.log("ai red")):(e.style.backgroundColor="green",console.log(e))}));const l=new Event("click");e.dispatchEvent(l)};u.addEventListener("click",(e=>{"horizontal"===c?(c="vertical",s=10):"vertical"===c&&(c="horizontal",s=1)}));class v{constructor(e){this.board=e||[],this.missed=[[]],this.hits=[],this.allow=!1}initialize(e){for(let t=0;t<10;t++){this.board[t]=[];for(let r=0;r<10;r++)this.board[t][r]=e,e++}}placeShip(e){let t=e.column,r=e.position;for(let e=0;e<r.length;e++)for(let l=0;l<r.length;l++)this.board[t[e]][this.board[t[e]].indexOf(r[l])]="x"}recieveAttack(e){this.hits.push(e)}allowAttack(){return this.allow}}(()=>{new e,new e;const o=new v,a=new v;o.initialize(0),a.initialize(100),r(o,"#primary-container","player-grids","horizontal"),r(a,"#secondary-container","ai-grids","x"),(e=>{const r=new t(5,[0,0,0,0,0],[101,102,103,104,105]),o=new t(4,[7,7,7,7],[173,174,175,176]),a=new t(3,[2,2,2],[122,123,124]),n=new t(3,[4,4,4],[144,145,146]),i=new t(2,[8,9],[181,191]);e.placeShip(r),e.placeShip(o),e.placeShip(a),e.placeShip(n),e.placeShip(i),l(e,"secondary-container","ai-grids")})(a),d(o,5,a)})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBVVUsVUFBVTVCLEdBQ3BCa0IsRUFBVVUsVUFBVXFCLEdBQ3BCL0IsRUFBVVUsVUFBVXNCLEdBQ3BCaEMsRUFBVVUsVUFBVXVCLEdBQ3BCakMsRUFBVVUsVUFBVXdCLEdBQ3BCNUQsRUFBWTBCLEVBQVUsc0JBQXNCLFdBQVcsRUV6U3ZEbUMsQ0FBY2xDLEdBQ2RGLEVBQWtCZSxFQUFZLEVBQUViLEVBQVEsRUFxQjVDbUMsRSIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZmFjdG9yaWVzL1BsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2ZhY3Rvcmllcy9TaGlwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvc2NyaXB0cy9kb20uanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9mYWN0b3JpZXMvR2FtZUJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvc2NyaXB0cy9tYWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBQbGF5ZXJ7XG4gICAgY29uc3RydWN0b3IoKXsgXG4gICAgICAgIHRoaXMudHVybiA9IHRydWU7XG4gICAgICAgIHRoaXMucG9zaXRpb24gPSB0aGlzLnBvc2l0aW9uO1xuICAgIH1cbiAgXG4gICAgYXV0b1BsYXkoZ3JpZCl7XG4gICAgICAgIFxuICAgICAgICBsZXQgcmFuZG9tID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKjEwMCk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZ3JpZFtyYW5kb21dO1xuICAgIH1cbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTaGlwe1xuICAgIGNvbnN0cnVjdG9yKGxlbmd0aCxjb2x1bW4scG9zaXRpb24pe1xuICAgICAgICB0aGlzLmxlbmd0aCA9IGxlbmd0aDtcbiAgICAgICAgdGhpcy5oaXRzID0gW107XG4gICAgICAgIHRoaXMucG9zaXRpb24gPSBwb3NpdGlvbnx8W107XG4gICAgICAgIHRoaXMuY29sdW1uID0gY29sdW1ufHxbXTtcbiAgICAgICBcbiAgICB9XG4gICAgaGl0KGhpdFBvc2l0aW9uKXtcbiAgICAgICAgLy8gaWYodGhpcy5wb3NpdGlvbi5pbmNsdWRlcyhoaXRQb3NpdGlvbikmJiAhKHRoaXMuaGl0cy5pbmNsdWRlcyhoaXRQb3NpdGlvbikpKXtcbiAgICAgICAgICAgIHRoaXMuaGl0cy5wdXNoKGhpdFBvc2l0aW9uKTtcbiAgICAgICAgLy99XG4gICAgICAgIFxuICAgIH1cblxuICAgIGlzU3Vuaygpe1xuICAgICAgICBpZih0aGlzLmxlbmd0aCA9PT0gdGhpcy5oaXRzLmxlbmd0aCl7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuXG4iLCJpbXBvcnQgR2FtZUJvYXJkIGZyb20gXCIuLi9mYWN0b3JpZXMvR2FtZUJvYXJkXCI7XG5pbXBvcnQgeyBQbGF5ZXIgfSBmcm9tIFwiLi4vZmFjdG9yaWVzL1BsYXllclwiO1xuaW1wb3J0IFNoaXAgZnJvbSBcIi4uL2ZhY3Rvcmllcy9TaGlwXCI7XG5cblxuLy8gVE9ETzogRml4IHNoaXAgaXNzdWUgd2hlcmUgc2hpcCBwbGFjZW1lbnQgb3ZlcmxhcFxuXG5leHBvcnQgY29uc3QgY3JlYXRlQm9hcmQgPSAobmV3Qm9hcmQsaWQsY2xhc3NOYW1lLGRpcmVjdGlvbik9PntcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGlkKTtcbiAgICBcbiAgICBsZXQgYm9hcmQgPSBuZXdCb2FyZC5ib2FyZDtcbiAgICBcbiAgICBib2FyZC5mb3JFYWNoKGU9PntcbiAgICAgICAgZS5mb3JFYWNoKGU9PntcbiAgICAgICAgICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgZGl2LmNsYXNzTGlzdC5hZGQoY2xhc3NOYW1lKTsgXG4gICAgICAgICAgICBkaXYuY2xhc3NMaXN0LmFkZChkaXJlY3Rpb24pOyBcbiAgICAgICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJyxlKTtcbiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXYpO1xuICAgICAgICAgICAgZGl2LnZhbHVlID0gZTtcbiAgICAgICAgICAgIGRpdi50ZXh0Q29udGVudCA9IGU7XG4gICAgICAgICAgICBcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5leHBvcnQgY29uc3QgdXBkYXRlQm9hcmQgPSAobmV3Qm9hcmQsY29udGFpbmVySUQsZ3JpZElELGRpcmVjdGlvbik9PntcbiAgICByZW1vdmVCb2FyZChjb250YWluZXJJRCxncmlkSUQpO1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2NvbnRhaW5lcklEfWApO1xuICAgIGxldCBib2FyZCA9IG5ld0JvYXJkLmJvYXJkO1xuICAgIGJvYXJkLmZvckVhY2goZT0+e1xuICAgICAgICBlLmZvckVhY2goZT0+e1xuICAgICAgICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBkaXYuY2xhc3NMaXN0LmFkZChncmlkSUQpOyBcbiAgICAgICAgICAgZGl2LmNsYXNzTGlzdC5hZGQoZGlyZWN0aW9uKTsgXG4gICAgICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCd2YWx1ZScsZSk7XG4gICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2KTtcbiAgICAgICAgICAgIGRpdi52YWx1ZSA9IGU7XG4gICAgICAgICAgICBkaXYudGV4dENvbnRlbnQgPSBlO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBcbiAgICAgICAgfSk7XG4gICAgICAgICBcbiAgICB9KTtcblxuICAgIFxufVxuZXhwb3J0IGNvbnN0IHJlbW92ZUJvYXJkID0gKGNvbnRhaW5lcklELGdyaWRJRCk9PntcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjJHtjb250YWluZXJJRH1gKTtcbiAgICBjb25zdCBncmlkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgLiR7Z3JpZElEfWApO1xuICAgIGdyaWQuZm9yRWFjaChlbGVtZW50PT4geyBcbiAgICAgICAgICAgIFxuICAgICAgICAgY29udGFpbmVyLnJlbW92ZUNoaWxkKGVsZW1lbnQpXG4gICAgICBcbiAgICAgICBcbiAgICB9KTtcbn1cbmV4cG9ydCBjb25zdCBjbGlja0V2ZW50ID0gKHBsYXllcixhaSk9PntcbiAgICBjb25zdCBncmlkcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5ncmlkcycpO1xuICAgIGdyaWRzLmZvckVhY2goZWxlbWVudD0+ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsKGUpPT57XG4gICAgICAgIGlmKHBsYXllci50dXJuKXtcbiAgICAgICAgICAgICBhaS50dXJuID0gdHJ1ZTtcbiAgICAgICAgICAgICBwbGF5ZXIudHVybiA9IGZhbHNlO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zb2xlLmxvZygncGxheWVyOiAnK2UudGFyZ2V0LnZhbHVlKTtcbiAgICAgICAgICAgICBjb25zdCBldmVudCA9IG5ldyBFdmVudCgnY2xpY2snKTtcbiAgICAgICAgICAgIGVsZW1lbnQuZGlzcGF0Y2hFdmVudChldmVudCk7XG4gICAgICAgIH1lbHNlIGlmKGFpLnR1cm4pe1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2FpOiAnKyBhaS5hdXRvUGxheSgpKTtcbiAgICAgICAgICAgIGFpLnR1cm4gPSBmYWxzZTtcbiAgICAgICAgICAgIHBsYXllci50dXJuID0gdHJ1ZTtcbiAgICAgICAgICAgIFxuICAgICAgICB9XG4gICAgICAgIFxuICAgIH0pKTtcbn1cblxuY29uc3QgY2hlY2tJZk91dE9mQm91bmQgPSAoc2hpcCxldmVudCxpbmNyZW1lbnQpPT57XG4gICAgbGV0IG91dE9mQm91bmQ1ID0gWzYsNyw4LDldO1xuICAgICBsZXQgb3V0T2ZCb3VuZDQgPSBbNyw4LDldO1xuICAgICBsZXQgb3V0T2ZCb3VuZDMgPSBbOCw5XTtcbiAgICAgbGV0IG91dE9mQm91bmQyID0gWzldO1xuICAgIFxuICAgIGlmKGluY3JlbWVudCA9PT0xKXtcbiAgICAgICAgc3dpdGNoKHRydWUpeyBcbiAgICAgICAgICAgICBjYXNlIHNoaXAubGVuZ3RoPT09NSAmJiBvdXRPZkJvdW5kNS5pbmNsdWRlcyhldmVudC50YXJnZXQudmFsdWUlMTApOlxuICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICBjYXNlIHNoaXAubGVuZ3RoPT09NCAmJiBvdXRPZkJvdW5kNC5pbmNsdWRlcyhldmVudC50YXJnZXQudmFsdWUlMTApOlxuICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICBjYXNlIHNoaXAubGVuZ3RoPT09MyAmJiBvdXRPZkJvdW5kMy5pbmNsdWRlcyhldmVudC50YXJnZXQudmFsdWUlMTApOlxuICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICBjYXNlIHNoaXAubGVuZ3RoPT09MiAmJiBvdXRPZkJvdW5kMi5pbmNsdWRlcyhldmVudC50YXJnZXQudmFsdWUlMTApOlxuICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gXG4gICAgIH1cbiAgICAgaWYoaW5jcmVtZW50ID09PTEwKXtcbiAgICAgICAgIHN3aXRjaCh0cnVlKXsgXG4gICAgICAgICAgICAgIGNhc2Ugc2hpcC5sZW5ndGg9PT01ICYmIG91dE9mQm91bmQ1LmluY2x1ZGVzKE1hdGguZmxvb3IoZXZlbnQudGFyZ2V0LnZhbHVlLzEwKSk6XG4gICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgY2FzZSBzaGlwLmxlbmd0aD09PTQgJiYgb3V0T2ZCb3VuZDQuaW5jbHVkZXMoTWF0aC5mbG9vcihldmVudC50YXJnZXQudmFsdWUvMTApKTpcbiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICBjYXNlIHNoaXAubGVuZ3RoPT09MyAmJiBvdXRPZkJvdW5kMy5pbmNsdWRlcyhNYXRoLmZsb29yKGV2ZW50LnRhcmdldC52YWx1ZS8xMCkpOlxuICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgIGNhc2Ugc2hpcC5sZW5ndGg9PT0yICYmIG91dE9mQm91bmQyLmluY2x1ZGVzKE1hdGguZmxvb3IoZXZlbnQudGFyZ2V0LnZhbHVlLzEwKSk6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgIH0gXG4gICAgICB9XG59XG5jb25zdCBnZXRDb29yZGluYXRlcyA9IChzaGlwLGV2ZW50LGNvbG9yLGluY3JlbWVudCk9PntcbiAgXG5cbiAgbGV0IGNvb3JkaW5hdGUgPSBbXTtcbiAgaWYgKHNoaXAubGVuZ3RoID09PSAxKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGZvciAobGV0IGkgPSAwOyBpIDw9IChzaGlwLmxlbmd0aCAtIDEpICogaW5jcmVtZW50OyBpID0gaSArIGluY3JlbWVudCkge1xuICAgICBpZihjaGVja0lmT3V0T2ZCb3VuZChzaGlwLGV2ZW50LGluY3JlbWVudCkpIHJldHVybjtcbiAgIFxuICAgIGlmIChzaGlwLmxlbmd0aCA9PT0gNSkge1xuICAgICAgaWYgKGV2ZW50LnRhcmdldC52YWx1ZSAlIDEwID09PSA2KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGV2ZW50LnRhcmdldC52YWx1ZSArIGkgPT0gXCJ4MFwiKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYGRpdlt2YWx1ZT1cIiR7ZXZlbnQudGFyZ2V0LnZhbHVlICsgaX1cIl1gKSA9PT0gbnVsbFxuICAgICkge1xuICAgICAgcmV0dXJuO1xuICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LnZhbHVlICsgaSA9PSBcIngwXCIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgYGRpdlt2YWx1ZT1cIiR7ZXZlbnQudGFyZ2V0LnZhbHVlICsgaX1cIl1gXG4gICAgKS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvcjtcbiAgICBjb29yZGluYXRlLnB1c2goZXZlbnQudGFyZ2V0LnZhbHVlICsgaSk7XG4gIH1cbiAgcmV0dXJuIGNvb3JkaW5hdGU7XG59XG5jb25zdCBnZXRDb2x1bW5zID0gKHNoaXApPT57XG4gICAgbGV0IGNvbHVtbnMgPSBbXTtcbiAgICBmb3IobGV0IGkgPSAwOyBpPD1zaGlwLmxlbmd0aC0xOyBpKyspe1xuICAgICAgICBcbiAgICAgICAgICBpZihzaGlwLnBvc2l0aW9uW2ldKXtcbiAgICAgICAgICAgICBjb2x1bW5zLnB1c2goTWF0aC5mbG9vcigoc2hpcC5wb3NpdGlvbltpXSkvMTApKTtcbiAgICAgICAgfSAgXG4gICAgICAgIFxuICAgICAgIFxuICAgIH1cbiAgXG4gICAgcmV0dXJuIGNvbHVtbnM7XG59XG5jb25zdCBjaGFuZ2VDb2xvciA9ICgpID0+e1xuICAgIGNvbnN0IHNlbGVjdCA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBsYXllci1ncmlkcycpKTtcbiAgICBzZWxlY3QuZmlsdGVyKGVsZW1lbnQ9PmVsZW1lbnQudmFsdWU9PT0neCcpLmZvckVhY2goZWxlbWVudD0+ZWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAndHJhbnNwYXJlbnQnKTtcbiAgICBcbiAgICBcbn1cbmxldCBmbGFnID0gdHJ1ZTtcbiBsZXQgZGlyZWN0aW9uID0gJ2hvcml6b250YWwnO1xuIGxldCBpbmNyZW1lbnQgPSAxO1xuIGNvbnN0IHJvdGF0ZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNyb3RhdGUnKTtcblxuZXhwb3J0IGNvbnN0IHJlbmRlclBsYXllclNoaXBzID0gICAoZ2FtZWJvYXJkLGxlbmd0aCxhaUJvYXJkKSA9PntcbiAgICBcbiAgICAvLyBjb25zb2xlLmxvZyhsZW5ndGgpO1xuICAgIGxldCBncmlkcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYC5wbGF5ZXItZ3JpZHMuJHtkaXJlY3Rpb259YCk7XG4gICAgXG4gICAgXG4gICAgY29uc3Qgc2hpcCA9IG5ldyBTaGlwKGxlbmd0aCxbMCwwLDBdLFsxLDIsM10pO1xuICAgIFxuICAgIGlmKGxlbmd0aD09PTMpe1xuICAgICAgICBpZihmbGFnKXtcbiAgICAgICAgICAgbGVuZ3RoKz0xOyBcbiAgICAgICAgICAgZmxhZz1mYWxzZTtcbiAgICAgICAgfSBcbiAgICB9XG4gICAgaWYobGVuZ3RoPD0xKXtcbiAgICAgICAgY29uc29sZS5sb2coJ2FtIGkgZXZlciBoZXJlPz8/PycpO1xuICAgICAgICBjb25zb2xlLmxvZyhnYW1lYm9hcmQpO1xuICAgICAgICBjb25zb2xlLmxvZyhhaUJvYXJkKTtcbiAgICAgICAgcmVuZGVyQXR0YWNrKGFpQm9hcmQsZ2FtZWJvYXJkKTtcbiAgICAgICAgZ2FtZWJvYXJkLmFsbG93ID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAgXG4gICAgZ3JpZHMuZm9yRWFjaChlbGVtZW50PT5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsKGUpPT57XG4gICAgICAgICAgICAgZ2V0Q29vcmRpbmF0ZXMoc2hpcCxlLCdibHVlJyxpbmNyZW1lbnQpO1xuICAgICAgICAgICAgIFxuICAgICAgICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywoZSk9PntcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICBzaGlwLnBvc2l0aW9uID0gZ2V0Q29vcmRpbmF0ZXMoc2hpcCxlLCdncmF5JyxpbmNyZW1lbnQpO1xuICAgICAgICAgICAgICAgc2hpcC5jb2x1bW4gPSBnZXRDb2x1bW5zKHNoaXApO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICBnYW1lYm9hcmQucGxhY2VTaGlwKHNoaXApO1xuICAgICAgICAgICAgICAgICB1cGRhdGVCb2FyZChnYW1lYm9hcmQsJ3ByaW1hcnktY29udGFpbmVyJyxcInBsYXllci1ncmlkc1wiLGRpcmVjdGlvbik7XG4gICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgY2hhbmdlQ29sb3IoKTtcbiAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICByZW5kZXJQbGF5ZXJTaGlwcyhnYW1lYm9hcmQsbGVuZ3RoLTEpO1xuICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICBcbiAgICB9KSk7XG4gICAgXG5cbiAgICBncmlkcy5mb3JFYWNoKGVsZW1lbnQ9PmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdXQnLChlKT0+e1xuICAgICAgICBnZXRDb29yZGluYXRlcyhzaGlwLGUsJ2dyYXknLGluY3JlbWVudCk7XG4gICAgfSkpOyAgXG4gICAgXG4gICBcbiAgIFxufVxuXG5cbmV4cG9ydCBjb25zdCByZW5kZXJBdHRhY2sgPSAoYWlCb2FyZCxwbGF5ZXJCb2FyZCkgPT57XG4gICAgbGV0IGFpO1xuICAgIGxldCByYW5kb21seVBpY2tlZEdyaWQ7XG4gICAgbGV0IGdyaWRWYWx1ZTtcbiAgICBjb25zdCBwbGF5ZXJHcmlkcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wbGF5ZXItZ3JpZHMnKTtcbiAgICBjb25zdCBhaUdyaWRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmFpLWdyaWRzJyk7XG4gICAgXG4gICAgXG4gICAgICAgIFxuICAgICAgICBhaUdyaWRzLmZvckVhY2goZWxlbWVudD0+ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsKGUpPT57XG4gICAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRWYWx1ZSA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICAgICAgICBhaSA9IG5ldyBQbGF5ZXIoKTtcbiAgICAgICAgICAgICAgcmFuZG9tbHlQaWNrZWRHcmlkID0gYWkuYXV0b1BsYXkocGxheWVyR3JpZHMpO1xuICAgICAgICAgICAgICBncmlkVmFsdWUgPSByYW5kb21seVBpY2tlZEdyaWQudmFsdWU7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmKGVsZW1lbnRWYWx1ZSA9PT0gJ3gnKXtcbiAgICAgICAgICAgICAgICBhaUJvYXJkLnJlY2lldmVBdHRhY2soZWxlbWVudFZhbHVlKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICdyZWQnO1xuICAgICAgICAgICAgICAgIHJlbmRlckFpQXR0YWNrKHJhbmRvbWx5UGlja2VkR3JpZCxncmlkVmFsdWUscGxheWVyQm9hcmQpO1xuICAgICAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ2dyZWVuJztcbiAgICAgICAgICAgICAgICByZW5kZXJBaUF0dGFjayhyYW5kb21seVBpY2tlZEdyaWQsZ3JpZFZhbHVlLHBsYXllckJvYXJkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICB9KSk7XG4gICAgICAgIFxuXG4gICAgXG4gICAgfVxuY29uc3QgcmVuZGVyQWlBdHRhY2sgPSAocmFuZG9tbHlQaWNrZWRHcmlkLGdyaWRWYWx1ZSxwbGF5ZXJCb2FyZCk9PntcbiAgICByYW5kb21seVBpY2tlZEdyaWQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLChlKT0+e1xuICAgICAgICBjb25zdCBlbGVtZW50VmFsdWUgPSBlLnRhcmdldC52YWx1ZTtcbiAgICAgICAgaWYoZ3JpZFZhbHVlPT09ICd4Jyl7XG4gICAgICAgICAgICBwbGF5ZXJCb2FyZC5yZWNpZXZlQXR0YWNrKGdyaWRWYWx1ZSk7XG4gICAgICAgICAgICByYW5kb21seVBpY2tlZEdyaWQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ3JlZCc7XG4gICAgICAgICAgICBwbGF5ZXJCb2FyZC5yZWNpZXZlQXR0YWNrKGVsZW1lbnRWYWx1ZSlcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhaSByZWQnKTtcblxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIC8vIHJhbmRvbWx5UGlja2VkR3JpZC5jbGFzc0xpc3QuYWRkKCdncmVlbicpO1xuICAgICAgICAgICAgIHJhbmRvbWx5UGlja2VkR3JpZC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnZ3JlZW4nO1xuICAgICAgICAgICAgY29uc29sZS5sb2cocmFuZG9tbHlQaWNrZWRHcmlkKTtcbiAgICAgICAgfVxuICAgICB9KTtcbiAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IEV2ZW50KCdjbGljaycpO1xuICAgICByYW5kb21seVBpY2tlZEdyaWQuZGlzcGF0Y2hFdmVudChldmVudCk7XG59XG5cbmV4cG9ydCBjb25zdCByZW5kZXJQbGF5ZXJBdHRhY2sgPSAoYm9hcmQpPT57XG4gICAgY29uc3QgYWlHcmlkcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5haS1ncmlkcycpO1xuICAgIGFpR3JpZHMuZm9yRWFjaChlbGVtZW50PT5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywoZSk9PntcbiAgICAgICAgaWYoZS50YXJnZXQudmFsdWUgPT09ICd4Jyl7XG4gICAgICAgICAgICBib2FyZC5yZWNpZXZlQXR0YWNrKGUudGFyZ2V0LnZhbHVlKTtcbiAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ3JlZCc7XG4gICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ2dyZWVuJztcbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9KSk7XG59XG5cbiByb3RhdGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLChlKT0+e1xuICAgICAgXG4gICAgICAgIGlmKGRpcmVjdGlvbiA9PT0naG9yaXpvbnRhbCcpe1xuICAgICAgICAgICAgZGlyZWN0aW9uID0gJ3ZlcnRpY2FsJztcbiAgICAgICAgICAgIGluY3JlbWVudCA9IDEwO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBcbiAgICAgICAgfWVsc2UgaWYoZGlyZWN0aW9uID09PSd2ZXJ0aWNhbCcpe1xuICAgICAgICAgICAgZGlyZWN0aW9uID0gJ2hvcml6b250YWwnO1xuICAgICAgICAgICAgaW5jcmVtZW50ID0gMTtcbiAgICAgICAgICAgXG4gICAgICAgICAgICBcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgXG4gICAgfSk7XG5cblxuXG5cblxuZXhwb3J0IGNvbnN0IHJlbmRlckFpU2hpcHMgPSAgKGdhbWVib2FyZCkgPT57XG4gICAgY29uc3Qgc2hpcCA9IG5ldyBTaGlwKDUsWzAsMCwwLDAsMF0sWzEwMSwxMDIsMTAzLDEwNCwxMDVdKTtcbiAgICBjb25zdCBzaGlwMiA9IG5ldyBTaGlwKDQsWzcsNyw3LDddLFsxNzMsMTc0LDE3NSwxNzZdKTtcbiAgICBjb25zdCBzaGlwMyA9IG5ldyBTaGlwKDMsWzIsMiwyXSxbMTIyLDEyMywxMjRdKTtcbiAgICBjb25zdCBzaGlwNCA9IG5ldyBTaGlwKDMsWzQsNCw0XSxbMTQ0LDE0NSwxNDZdKTtcbiAgICBjb25zdCBzaGlwNSA9IG5ldyBTaGlwKDIsWzgsOV0sWzE4MSwxOTFdKTtcbiAgICBcbiAgICBnYW1lYm9hcmQucGxhY2VTaGlwKHNoaXApO1xuICAgIGdhbWVib2FyZC5wbGFjZVNoaXAoc2hpcDIpO1xuICAgIGdhbWVib2FyZC5wbGFjZVNoaXAoc2hpcDMpO1xuICAgIGdhbWVib2FyZC5wbGFjZVNoaXAoc2hpcDQpO1xuICAgIGdhbWVib2FyZC5wbGFjZVNoaXAoc2hpcDUpO1xuICAgIHVwZGF0ZUJvYXJkKGdhbWVib2FyZCwnc2Vjb25kYXJ5LWNvbnRhaW5lcicsXCJhaS1ncmlkc1wiKTtcbn1cblxuXG5cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWVCb2FyZCB7XG4gIGNvbnN0cnVjdG9yKGJvYXJkKSB7XG4gICAgdGhpcy5ib2FyZCA9IGJvYXJkIHx8IFtdO1xuICAgIHRoaXMubWlzc2VkID0gW1tdXTtcbiAgICB0aGlzLmhpdHMgPSBbXTtcbiAgICB0aGlzLmFsbG93ID0gZmFsc2U7XG4gIH1cblxuICBpbml0aWFsaXplKGNvdW50KSB7XG4gICAgXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICB0aGlzLmJvYXJkW2ldID0gW107XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgdGhpcy5ib2FyZFtpXVtqXSA9IGNvdW50O1xuICAgICAgICBjb3VudCsrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBcblxuXG4gIHBsYWNlU2hpcChzaGlwKSB7XG4gICAgbGV0IGNvbHVtbiA9IHNoaXAuY29sdW1uO1xuICAgIGxldCBwb3NpdGlvbiA9IHNoaXAucG9zaXRpb247XG4gICAgXG4gICBcbiAgICBmb3IobGV0IGk9MDsgaTxwb3NpdGlvbi5sZW5ndGg7aSsrKXtcbiAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHBvc2l0aW9uLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIC8vIGlmKCh0aGlzLmJvYXJkW2NvbHVtbltpXSsxXVt0aGlzLmJvYXJkW2NvbHVtbltpXSsxXS5pbmRleE9mKHBvc2l0aW9uW2pdKzEwKV0pIT0neCcpe1xuICAgICAgICAgIHRoaXMuYm9hcmRbY29sdW1uW2ldXVt0aGlzLmJvYXJkW2NvbHVtbltpXV0uaW5kZXhPZihwb3NpdGlvbltqXSldID0gJ3gnO1xuICAgICAgICBcbiAgICAgICAgLy8gfVxuICAgIH1cbiAgIH1cbiAgIFxuICB9XG4gIFxuIFxuIFxuICByZWNpZXZlQXR0YWNrKHBvc2l0aW9uKXtcbiAgICBcbiAgICAgICAgdGhpcy5oaXRzLnB1c2gocG9zaXRpb24pO1xuICAgIFxuICB9XG5cbiAgYWxsb3dBdHRhY2soKXtcbiAgICByZXR1cm4gdGhpcy5hbGxvdztcbiAgfVxuXG4gIC8vIHJlY2lldmVBdHRhY2soY29sdW1uLCBwb3NpdGlvbikge1xuICAvLyAgIGZvcihsZXQgaT0wOyBpPHBvc2l0aW9uLmxlbmd0aDsgaSsrKXtcbiAgLy8gICAgIGZvcihsZXQgaj0wOyBqPHBvc2l0aW9uLmxlbmd0aDsgaisrKXtcbiAgLy8gICAgICAgaWYgKHRoaXMuYm9hcmRbY29sdW1uW2ldXVtwb3NpdGlvbltqXV0gPT09IFwieFwiKSB7XG4gIC8vICAgICAgICAgaWYgKHRoaXMuaGl0c1tjb2x1bW5baV1dID09PSB1bmRlZmluZWQpIHtcbiAgLy8gICAgICAgdGhpcy5oaXRzW2NvbHVtbltpXV0gPSBbcG9zaXRpb25bal1dO1xuICAvLyAgICAgfSBlbHNlIHtcbiAgLy8gICAgICAgdGhpcy5oaXRzW2NvbHVtbltpXV0ucHVzaChwb3NpdGlvbltpXSk7XG4gIC8vICAgICB9XG4gIC8vICAgfSBlbHNlIGlmICh0aGlzLm1pc3NlZFtjb2x1bW5dID09PSB1bmRlZmluZWQpIHtcbiAgLy8gICAgIHRoaXMubWlzc2VkW2NvbHVtbl0gPSBbcG9zaXRpb25dO1xuICAvLyAgIH0gZWxzZSB7XG4gIC8vICAgICB0aGlzLm1pc3NlZFtjb2x1bW5dLnB1c2gocG9zaXRpb24pO1xuICAvLyAgIH1cbiAgLy8gICAgIH1cbiAgLy8gICB9XG4gICAgXG4gIC8vIH1cbiBcbn1cbiIsImltcG9ydCBHYW1lQm9hcmQgZnJvbSBcIi4uL2ZhY3Rvcmllcy9HYW1lQm9hcmRcIjtcbmltcG9ydCB7IFBsYXllciB9IGZyb20gXCIuLi9mYWN0b3JpZXMvUGxheWVyXCJcbmltcG9ydCBTaGlwIGZyb20gXCIuLi9mYWN0b3JpZXMvU2hpcFwiO1xuaW1wb3J0IHsgY2xpY2tFdmVudCwgY3JlYXRlQm9hcmQsIHJlbW92ZUJvYXJkLCByZW5kZXJBaVNoaXBzLCByZW5kZXJBdHRhY2ssIHJlbmRlclBsYXllclNoaXBzLCB1cGRhdGVCb2FyZCAsIHJlbmRlckFpQXR0YWNrfSBmcm9tIFwiLi9kb21cIjtcblxuZXhwb3J0IGNvbnN0IHJ1bkdhbWUgPSAoKT0+e1xuICAgIGNvbnN0IHBsYXllciA9IG5ldyBQbGF5ZXIoKTtcbiAgICBjb25zdCBhaSA9IG5ldyBQbGF5ZXIoKTtcbiAgIFxuXG4gICAgY29uc3QgcGxheWVyQm9hcmQgPSBuZXcgR2FtZUJvYXJkKCk7XG4gICAgY29uc3QgYWlCb2FyZCA9IG5ldyBHYW1lQm9hcmQoKTtcbiAgICBwbGF5ZXJCb2FyZC5pbml0aWFsaXplKDApO1xuICAgIGFpQm9hcmQuaW5pdGlhbGl6ZSgxMDApO1xuICAgIFxuICAgIGNyZWF0ZUJvYXJkKHBsYXllckJvYXJkLCcjcHJpbWFyeS1jb250YWluZXInLCdwbGF5ZXItZ3JpZHMnLCdob3Jpem9udGFsJyk7XG4gICAgY3JlYXRlQm9hcmQoYWlCb2FyZCwnI3NlY29uZGFyeS1jb250YWluZXInLCdhaS1ncmlkcycsJ3gnKTtcbiAgICBcbiAgICByZW5kZXJBaVNoaXBzKGFpQm9hcmQpO1xuICAgIHJlbmRlclBsYXllclNoaXBzKHBsYXllckJvYXJkLDUsYWlCb2FyZCk7IFxuICAgIFxuICAgICAgIFxuICAgIC8vICByZW5kZXJBdHRhY2soYWlCb2FyZCxwbGF5ZXJCb2FyZCk7XG4gICAgXG4gICBcbiAgICBcbiAgICAvLyByZW5kZXJTaGlwcyhnYW1lYm9hcmQsNCk7XG4gICAvLyB1cGRhdGVCb2FyZChnYW1lYm9hcmQsJ3ByaW1hcnktY29udGFpbmVyJyxcInBsYXllci1ncmlkc1wiKTtcbiAgICAgXG4gICAgLy8gZm9yKGxldCBpID0wO2k8NDsgaSsrKXtcbiAgICAgICBcbiAgICAvLyAgICAgcmVuZGVyU2hpcHMoZ2FtZWJvYXJkLDQpO1xuICAgIC8vIH1cbiAgICAgXG4gICAgXG5cbiAgIFxuICAgIC8vICBjb25zb2xlLmxvZyhnYW1lYm9hcmQuYm9hcmQpO1xuICAgIC8vICBjbGlja0V2ZW50KHBsYXllcixhaSk7XG59XG5ydW5HYW1lKCk7Il0sIm5hbWVzIjpbIlBsYXllciIsImNvbnN0cnVjdG9yIiwidGhpcyIsInR1cm4iLCJwb3NpdGlvbiIsImF1dG9QbGF5IiwiZ3JpZCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsIlNoaXAiLCJsZW5ndGgiLCJjb2x1bW4iLCJoaXRzIiwiaGl0IiwiaGl0UG9zaXRpb24iLCJwdXNoIiwiaXNTdW5rIiwiY3JlYXRlQm9hcmQiLCJuZXdCb2FyZCIsImlkIiwiY2xhc3NOYW1lIiwiZGlyZWN0aW9uIiwiY29udGFpbmVyIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiYm9hcmQiLCJmb3JFYWNoIiwiZSIsImRpdiIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJzZXRBdHRyaWJ1dGUiLCJhcHBlbmRDaGlsZCIsInZhbHVlIiwidGV4dENvbnRlbnQiLCJ1cGRhdGVCb2FyZCIsImNvbnRhaW5lcklEIiwiZ3JpZElEIiwicmVtb3ZlQm9hcmQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZWxlbWVudCIsInJlbW92ZUNoaWxkIiwiY2hlY2tJZk91dE9mQm91bmQiLCJzaGlwIiwiZXZlbnQiLCJpbmNyZW1lbnQiLCJvdXRPZkJvdW5kNSIsIm91dE9mQm91bmQ0Iiwib3V0T2ZCb3VuZDMiLCJvdXRPZkJvdW5kMiIsImluY2x1ZGVzIiwidGFyZ2V0IiwiZ2V0Q29vcmRpbmF0ZXMiLCJjb2xvciIsImNvb3JkaW5hdGUiLCJpIiwic3R5bGUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJmbGFnIiwicm90YXRlQnV0dG9uIiwicmVuZGVyUGxheWVyU2hpcHMiLCJnYW1lYm9hcmQiLCJhaUJvYXJkIiwiZ3JpZHMiLCJjb25zb2xlIiwibG9nIiwicmVuZGVyQXR0YWNrIiwiYWxsb3ciLCJhZGRFdmVudExpc3RlbmVyIiwiY29sdW1ucyIsImdldENvbHVtbnMiLCJwbGFjZVNoaXAiLCJBcnJheSIsImZyb20iLCJmaWx0ZXIiLCJwbGF5ZXJCb2FyZCIsImFpIiwicmFuZG9tbHlQaWNrZWRHcmlkIiwiZ3JpZFZhbHVlIiwicGxheWVyR3JpZHMiLCJlbGVtZW50VmFsdWUiLCJyZWNpZXZlQXR0YWNrIiwicmVuZGVyQWlBdHRhY2siLCJFdmVudCIsImRpc3BhdGNoRXZlbnQiLCJHYW1lQm9hcmQiLCJtaXNzZWQiLCJpbml0aWFsaXplIiwiY291bnQiLCJqIiwiaW5kZXhPZiIsImFsbG93QXR0YWNrIiwic2hpcDIiLCJzaGlwMyIsInNoaXA0Iiwic2hpcDUiLCJyZW5kZXJBaVNoaXBzIiwicnVuR2FtZSJdLCJzb3VyY2VSb290IjoiIn0=