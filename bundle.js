(()=>{"use strict";class e{constructor(e){this.board=e||[],this.missed=[[]],this.hits=[],this.allow=!1}initialize(e){for(let t=0;t<10;t++){this.board[t]=[];for(let r=0;r<10;r++)this.board[t][r]=e,e++}}placeShip(e){let t=e.column,r=e.position;for(let e=0;e<r.length;e++)for(let o=0;o<r.length;o++)this.board[t[e]][this.board[t[e]].indexOf(r[o])]="x"}recieveAttack(e){this.hits.push(e)}allowAttack(){return this.allow}}class t{constructor(){this.turn=!0,this.position=this.position}autoPlay(e){return e[Math.floor(100*Math.random())]}}class r{constructor(e,t,r){this.length=e,this.hits=[],this.position=r||[],this.column=t||[]}hit(e){this.hits.push(e)}isSunk(){return this.length===this.hits.length}}const o=(e,t,r,o)=>{const l=document.querySelector(t);e.board.forEach((e=>{e.forEach((e=>{const t=document.createElement("div");t.classList.add(r),t.classList.add(o),t.setAttribute("value",e),l.appendChild(t),t.value=e,t.textContent=e}))}))},l=(e,t,r,o)=>{n(t,r);const l=document.querySelector(`#${t}`);e.board.forEach((e=>{e.forEach((e=>{const t=document.createElement("div");t.classList.add(r),t.classList.add(o),t.setAttribute("value",e),l.appendChild(t),t.value=e,t.textContent=e}))}))},n=(e,t)=>{const r=document.querySelector(`#${e}`);document.querySelectorAll(`.${t}`).forEach((e=>{r.removeChild(e)}))},a=(e,t,r)=>{let o=[6,7,8,9],l=[7,8,9],n=[8,9],a=[9];if(1===r)switch(!0){case 5===e.length&&o.includes(t.target.value%10):case 4===e.length&&l.includes(t.target.value%10):case 3===e.length&&n.includes(t.target.value%10):case 2===e.length&&a.includes(t.target.value%10):return!0}if(10===r)switch(!0){case 5===e.length&&o.includes(Math.floor(t.target.value/10)):case 4===e.length&&l.includes(Math.floor(t.target.value/10)):case 3===e.length&&n.includes(Math.floor(t.target.value/10)):case 2===e.length&&a.includes(Math.floor(t.target.value/10)):return!0}},i=(e,t,r,o)=>{let l=[];if(1!==e.length){for(let n=0;n<=(e.length-1)*o;n+=o){if(a(e,t,o))return;if(5===e.length&&t.target.value%10==6)return;if(t.target.value+n=="x0")return;if(null===document.querySelector(`div[value="${t.target.value+n}"]`))return;if(t.target.value+n=="x0")return;document.querySelector(`div[value="${t.target.value+n}"]`).style.backgroundColor=r,l.push(t.target.value+n)}return l}};let c=!0,s="horizontal",u=1;const h=document.querySelector("#rotate"),d=(e,t,o)=>{let n=document.querySelectorAll(`.player-grids.${s}`);const a=new r(t,[0,0,0],[1,2,3]);if(3===t&&c&&(t+=1,c=!1),t<=1)return console.log("am i ever here????"),void g(e);n.forEach((r=>r.addEventListener("mouseover",(n=>{i(a,n,"blue",u),r.addEventListener("click",(r=>{console.log(o),a.position=i(a,r,"gray",u),a.column=(e=>{let t=[];for(let r=0;r<=e.length-1;r++)e.position[r]&&t.push(Math.floor(e.position[r]/10));return t})(a),e.placeShip(a),l(e,"primary-container","player-grids",s),Array.from(document.querySelectorAll(".player-grids")).filter((e=>"x"===e.value)).forEach((e=>e.style.backgroundColor="transparent")),d(e,t-1)}))})))),n.forEach((e=>e.addEventListener("mouseout",(e=>{i(a,e,"gray",u)}))))},g=r=>{let o,l,n,a=new e;const i=document.querySelectorAll(".player-grids");return document.querySelectorAll(".ai-grids").forEach((e=>e.addEventListener("click",(c=>{const s=c.target.value;console.log("element:"+s),o=new t,l=o.autoPlay(i),n=l.value,5===a.hits.length&&console.log("player won!"),"x"===s?(a.recieveAttack(s),e.style.backgroundColor="red",v(l,n,r),console.log("hits:"+a.hits.length)):(e.style.backgroundColor="green",v(l,n,r))})))),{aiBoard:a}},v=(e,t,r)=>{e.addEventListener("click",(o=>{const l=o.target.value;"x"===t?(r.recieveAttack(t),e.style.backgroundColor="red",r.recieveAttack(l),console.log("ai red")):e.style.backgroundColor="green"}));const o=new Event("click");e.dispatchEvent(o)};h.addEventListener("click",(e=>{"horizontal"===s?(s="vertical",u=10):"vertical"===s&&(s="horizontal",u=1)})),(()=>{new t,new t;const n=new e,a=new e;n.initialize(0),a.initialize(100),o(n,"#primary-container","player-grids","horizontal"),o(a,"#secondary-container","ai-grids","horizontal"),(e=>{const t=new r(5,[0,0,0,0,0],[101,102,103,104,105]),o=new r(4,[7,7,7,7],[173,174,175,176]),n=new r(3,[2,2,2],[122,123,124]),a=new r(3,[4,4,4],[144,145,146]),i=new r(2,[8,9],[181,191]);e.placeShip(t),l(e,"secondary-container","ai-grids","horizontal"),e.placeShip(o),l(e,"secondary-container","ai-grids","horizontal"),e.placeShip(n),l(e,"secondary-container","ai-grids","horizontal"),e.placeShip(a),l(e,"secondary-container","ai-grids","horizontal"),e.placeShip(i),l(e,"secondary-container","ai-grids","horizontal")})(a),d(n,5,a)})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dEUsRUFBSyxFQUFFLENBQUMsRUFBRSxHQUFHLENBQUMsSUFBSSxNQUVwQzhDLEVBQVU5RCxVQUFVQyxHQUNwQnFDLEVBQVl3QixFQUFVLHNCQUFzQixXQUFXLGNBQ3ZEQSxFQUFVOUQsVUFBVW1GLEdBQ3BCN0MsRUFBWXdCLEVBQVUsc0JBQXNCLFdBQVcsY0FDdkRBLEVBQVU5RCxVQUFVb0YsR0FDcEI5QyxFQUFZd0IsRUFBVSxzQkFBc0IsV0FBVyxjQUN2REEsRUFBVTlELFVBQVVxRixHQUNwQi9DLEVBQVl3QixFQUFVLHNCQUFzQixXQUFXLGNBQ3ZEQSxFQUFVOUQsVUFBVXNGLEdBQ3BCaEQsRUFBWXdCLEVBQVUsc0JBQXNCLFdBQVcsYUFBYSxFQzNUcEV5QixDQUFjeEIsR0FFZEYsRUFBa0JhLEVBQVksRUFBRVgsRUFBUSxFQXFCNUN5QixFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9mYWN0b3JpZXMvR2FtZUJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZmFjdG9yaWVzL1BsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2ZhY3Rvcmllcy9TaGlwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvc2NyaXB0cy9kb20uanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9zY3JpcHRzL21haW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2FtZUJvYXJkIHtcbiAgY29uc3RydWN0b3IoYm9hcmQpIHtcbiAgICB0aGlzLmJvYXJkID0gYm9hcmQgfHwgW107XG4gICAgdGhpcy5taXNzZWQgPSBbW11dO1xuICAgIHRoaXMuaGl0cyA9IFtdO1xuICAgIHRoaXMuYWxsb3cgPSBmYWxzZTtcbiAgfVxuXG4gIGluaXRpYWxpemUoY291bnQpIHtcbiAgICBcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgICAgIHRoaXMuYm9hcmRbaV0gPSBbXTtcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGorKykge1xuICAgICAgICB0aGlzLmJvYXJkW2ldW2pdID0gY291bnQ7XG4gICAgICAgIGNvdW50Kys7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuXG5cbiAgcGxhY2VTaGlwKHNoaXApIHtcbiAgICBsZXQgY29sdW1uID0gc2hpcC5jb2x1bW47XG4gICAgbGV0IHBvc2l0aW9uID0gc2hpcC5wb3NpdGlvbjtcbiAgICBcbiAgIFxuICAgIGZvcihsZXQgaT0wOyBpPHBvc2l0aW9uLmxlbmd0aDtpKyspe1xuICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgcG9zaXRpb24ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgLy8gaWYoKHRoaXMuYm9hcmRbY29sdW1uW2ldKzFdW3RoaXMuYm9hcmRbY29sdW1uW2ldKzFdLmluZGV4T2YocG9zaXRpb25bal0rMTApXSkhPSd4Jyl7XG4gICAgICAgICAgdGhpcy5ib2FyZFtjb2x1bW5baV1dW3RoaXMuYm9hcmRbY29sdW1uW2ldXS5pbmRleE9mKHBvc2l0aW9uW2pdKV0gPSAneCc7XG4gICAgICAgIFxuICAgICAgICAvLyB9XG4gICAgfVxuICAgfVxuICAgXG4gIH1cbiAgXG4gXG4gXG4gIHJlY2lldmVBdHRhY2socG9zaXRpb24pe1xuICAgIFxuICAgICAgICB0aGlzLmhpdHMucHVzaChwb3NpdGlvbik7XG4gICAgXG4gIH1cblxuICBhbGxvd0F0dGFjaygpe1xuICAgIHJldHVybiB0aGlzLmFsbG93O1xuICB9XG5cbiAgLy8gcmVjaWV2ZUF0dGFjayhjb2x1bW4sIHBvc2l0aW9uKSB7XG4gIC8vICAgZm9yKGxldCBpPTA7IGk8cG9zaXRpb24ubGVuZ3RoOyBpKyspe1xuICAvLyAgICAgZm9yKGxldCBqPTA7IGo8cG9zaXRpb24ubGVuZ3RoOyBqKyspe1xuICAvLyAgICAgICBpZiAodGhpcy5ib2FyZFtjb2x1bW5baV1dW3Bvc2l0aW9uW2pdXSA9PT0gXCJ4XCIpIHtcbiAgLy8gICAgICAgICBpZiAodGhpcy5oaXRzW2NvbHVtbltpXV0gPT09IHVuZGVmaW5lZCkge1xuICAvLyAgICAgICB0aGlzLmhpdHNbY29sdW1uW2ldXSA9IFtwb3NpdGlvbltqXV07XG4gIC8vICAgICB9IGVsc2Uge1xuICAvLyAgICAgICB0aGlzLmhpdHNbY29sdW1uW2ldXS5wdXNoKHBvc2l0aW9uW2ldKTtcbiAgLy8gICAgIH1cbiAgLy8gICB9IGVsc2UgaWYgKHRoaXMubWlzc2VkW2NvbHVtbl0gPT09IHVuZGVmaW5lZCkge1xuICAvLyAgICAgdGhpcy5taXNzZWRbY29sdW1uXSA9IFtwb3NpdGlvbl07XG4gIC8vICAgfSBlbHNlIHtcbiAgLy8gICAgIHRoaXMubWlzc2VkW2NvbHVtbl0ucHVzaChwb3NpdGlvbik7XG4gIC8vICAgfVxuICAvLyAgICAgfVxuICAvLyAgIH1cbiAgICBcbiAgLy8gfVxuIFxufVxuIiwiZXhwb3J0IGNsYXNzIFBsYXllcntcbiAgICBjb25zdHJ1Y3RvcigpeyBcbiAgICAgICAgdGhpcy50dXJuID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IHRoaXMucG9zaXRpb247XG4gICAgfVxuICBcbiAgICBhdXRvUGxheShncmlkKXtcbiAgICAgICAgXG4gICAgICAgIGxldCByYW5kb20gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMTAwKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBncmlkW3JhbmRvbV07XG4gICAgfVxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNoaXB7XG4gICAgY29uc3RydWN0b3IobGVuZ3RoLGNvbHVtbixwb3NpdGlvbil7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gbGVuZ3RoO1xuICAgICAgICB0aGlzLmhpdHMgPSBbXTtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IHBvc2l0aW9ufHxbXTtcbiAgICAgICAgdGhpcy5jb2x1bW4gPSBjb2x1bW58fFtdO1xuICAgICAgIFxuICAgIH1cbiAgICBoaXQoaGl0UG9zaXRpb24pe1xuICAgICAgICAvLyBpZih0aGlzLnBvc2l0aW9uLmluY2x1ZGVzKGhpdFBvc2l0aW9uKSYmICEodGhpcy5oaXRzLmluY2x1ZGVzKGhpdFBvc2l0aW9uKSkpe1xuICAgICAgICAgICAgdGhpcy5oaXRzLnB1c2goaGl0UG9zaXRpb24pO1xuICAgICAgICAvL31cbiAgICAgICAgXG4gICAgfVxuXG4gICAgaXNTdW5rKCl7XG4gICAgICAgIGlmKHRoaXMubGVuZ3RoID09PSB0aGlzLmhpdHMubGVuZ3RoKXtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59XG5cbiIsImltcG9ydCBHYW1lQm9hcmQgZnJvbSBcIi4uL2ZhY3Rvcmllcy9HYW1lQm9hcmRcIjtcbmltcG9ydCB7IFBsYXllciB9IGZyb20gXCIuLi9mYWN0b3JpZXMvUGxheWVyXCI7XG5pbXBvcnQgU2hpcCBmcm9tIFwiLi4vZmFjdG9yaWVzL1NoaXBcIjtcblxuXG4vLyBUT0RPOiBGaXggc2hpcCBpc3N1ZSB3aGVyZSBzaGlwIHBsYWNlbWVudCBvdmVybGFwXG5cbmV4cG9ydCBjb25zdCBjcmVhdGVCb2FyZCA9IChuZXdCb2FyZCxpZCxjbGFzc05hbWUsZGlyZWN0aW9uKT0+e1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaWQpO1xuICAgIFxuICAgIGxldCBib2FyZCA9IG5ld0JvYXJkLmJvYXJkO1xuICAgIFxuICAgIGJvYXJkLmZvckVhY2goZT0+e1xuICAgICAgICBlLmZvckVhY2goZT0+e1xuICAgICAgICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBkaXYuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpOyBcbiAgICAgICAgICAgIGRpdi5jbGFzc0xpc3QuYWRkKGRpcmVjdGlvbik7IFxuICAgICAgICAgICAgZGl2LnNldEF0dHJpYnV0ZSgndmFsdWUnLGUpO1xuICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdik7XG4gICAgICAgICAgICBkaXYudmFsdWUgPSBlO1xuICAgICAgICAgICAgZGl2LnRleHRDb250ZW50ID0gZTtcbiAgICAgICAgICAgIFxuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydCBjb25zdCB1cGRhdGVCb2FyZCA9IChuZXdCb2FyZCxjb250YWluZXJJRCxncmlkSUQsZGlyZWN0aW9uKT0+e1xuICAgIHJlbW92ZUJvYXJkKGNvbnRhaW5lcklELGdyaWRJRCk7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgIyR7Y29udGFpbmVySUR9YCk7XG4gICAgbGV0IGJvYXJkID0gbmV3Qm9hcmQuYm9hcmQ7XG4gICAgYm9hcmQuZm9yRWFjaChlPT57XG4gICAgICAgIGUuZm9yRWFjaChlPT57XG4gICAgICAgICAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGRpdi5jbGFzc0xpc3QuYWRkKGdyaWRJRCk7IFxuICAgICAgICAgICBkaXYuY2xhc3NMaXN0LmFkZChkaXJlY3Rpb24pOyBcbiAgICAgICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJyxlKTtcbiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXYpO1xuICAgICAgICAgICAgZGl2LnZhbHVlID0gZTtcbiAgICAgICAgICAgIGRpdi50ZXh0Q29udGVudCA9IGU7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIFxuICAgICAgICB9KTtcbiAgICAgICAgIFxuICAgIH0pO1xuXG4gICAgXG59XG5leHBvcnQgY29uc3QgcmVtb3ZlQm9hcmQgPSAoY29udGFpbmVySUQsZ3JpZElEKT0+e1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2NvbnRhaW5lcklEfWApO1xuICAgIGNvbnN0IGdyaWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGAuJHtncmlkSUR9YCk7XG4gICAgZ3JpZC5mb3JFYWNoKGVsZW1lbnQ9PiB7IFxuICAgICAgICAgICAgXG4gICAgICAgICBjb250YWluZXIucmVtb3ZlQ2hpbGQoZWxlbWVudClcbiAgICAgIFxuICAgICAgIFxuICAgIH0pO1xufVxuZXhwb3J0IGNvbnN0IGNsaWNrRXZlbnQgPSAocGxheWVyLGFpKT0+e1xuICAgIGNvbnN0IGdyaWRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmdyaWRzJyk7XG4gICAgZ3JpZHMuZm9yRWFjaChlbGVtZW50PT5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywoZSk9PntcbiAgICAgICAgaWYocGxheWVyLnR1cm4pe1xuICAgICAgICAgICAgIGFpLnR1cm4gPSB0cnVlO1xuICAgICAgICAgICAgIHBsYXllci50dXJuID0gZmFsc2U7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdwbGF5ZXI6ICcrZS50YXJnZXQudmFsdWUpO1xuICAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IEV2ZW50KCdjbGljaycpO1xuICAgICAgICAgICAgZWxlbWVudC5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcbiAgICAgICAgfWVsc2UgaWYoYWkudHVybil7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnYWk6ICcrIGFpLmF1dG9QbGF5KCkpO1xuICAgICAgICAgICAgYWkudHVybiA9IGZhbHNlO1xuICAgICAgICAgICAgcGxheWVyLnR1cm4gPSB0cnVlO1xuICAgICAgICAgICAgXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfSkpO1xufVxuXG5jb25zdCBjaGVja0lmT3V0T2ZCb3VuZCA9IChzaGlwLGV2ZW50LGluY3JlbWVudCk9PntcbiAgICBsZXQgb3V0T2ZCb3VuZDUgPSBbNiw3LDgsOV07XG4gICAgIGxldCBvdXRPZkJvdW5kNCA9IFs3LDgsOV07XG4gICAgIGxldCBvdXRPZkJvdW5kMyA9IFs4LDldO1xuICAgICBsZXQgb3V0T2ZCb3VuZDIgPSBbOV07XG4gICAgXG4gICAgaWYoaW5jcmVtZW50ID09PTEpe1xuICAgICAgICBzd2l0Y2godHJ1ZSl7IFxuICAgICAgICAgICAgIGNhc2Ugc2hpcC5sZW5ndGg9PT01ICYmIG91dE9mQm91bmQ1LmluY2x1ZGVzKGV2ZW50LnRhcmdldC52YWx1ZSUxMCk6XG4gICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgIGNhc2Ugc2hpcC5sZW5ndGg9PT00ICYmIG91dE9mQm91bmQ0LmluY2x1ZGVzKGV2ZW50LnRhcmdldC52YWx1ZSUxMCk6XG4gICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgIGNhc2Ugc2hpcC5sZW5ndGg9PT0zICYmIG91dE9mQm91bmQzLmluY2x1ZGVzKGV2ZW50LnRhcmdldC52YWx1ZSUxMCk6XG4gICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgIGNhc2Ugc2hpcC5sZW5ndGg9PT0yICYmIG91dE9mQm91bmQyLmluY2x1ZGVzKGV2ZW50LnRhcmdldC52YWx1ZSUxMCk6XG4gICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBcbiAgICAgfVxuICAgICBpZihpbmNyZW1lbnQgPT09MTApe1xuICAgICAgICAgc3dpdGNoKHRydWUpeyBcbiAgICAgICAgICAgICAgY2FzZSBzaGlwLmxlbmd0aD09PTUgJiYgb3V0T2ZCb3VuZDUuaW5jbHVkZXMoTWF0aC5mbG9vcihldmVudC50YXJnZXQudmFsdWUvMTApKTpcbiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICBjYXNlIHNoaXAubGVuZ3RoPT09NCAmJiBvdXRPZkJvdW5kNC5pbmNsdWRlcyhNYXRoLmZsb29yKGV2ZW50LnRhcmdldC52YWx1ZS8xMCkpOlxuICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgIGNhc2Ugc2hpcC5sZW5ndGg9PT0zICYmIG91dE9mQm91bmQzLmluY2x1ZGVzKE1hdGguZmxvb3IoZXZlbnQudGFyZ2V0LnZhbHVlLzEwKSk6XG4gICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgY2FzZSBzaGlwLmxlbmd0aD09PTIgJiYgb3V0T2ZCb3VuZDIuaW5jbHVkZXMoTWF0aC5mbG9vcihldmVudC50YXJnZXQudmFsdWUvMTApKTpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgfSBcbiAgICAgIH1cbn1cbmNvbnN0IGdldENvb3JkaW5hdGVzID0gKHNoaXAsZXZlbnQsY29sb3IsaW5jcmVtZW50KT0+e1xuICBcblxuICBsZXQgY29vcmRpbmF0ZSA9IFtdO1xuICBpZiAoc2hpcC5sZW5ndGggPT09IDEpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgZm9yIChsZXQgaSA9IDA7IGkgPD0gKHNoaXAubGVuZ3RoIC0gMSkgKiBpbmNyZW1lbnQ7IGkgPSBpICsgaW5jcmVtZW50KSB7XG4gICAgIGlmKGNoZWNrSWZPdXRPZkJvdW5kKHNoaXAsZXZlbnQsaW5jcmVtZW50KSkgcmV0dXJuO1xuICAgXG4gICAgaWYgKHNoaXAubGVuZ3RoID09PSA1KSB7XG4gICAgICBpZiAoZXZlbnQudGFyZ2V0LnZhbHVlICUgMTAgPT09IDYpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoZXZlbnQudGFyZ2V0LnZhbHVlICsgaSA9PSBcIngwXCIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgZGl2W3ZhbHVlPVwiJHtldmVudC50YXJnZXQudmFsdWUgKyBpfVwiXWApID09PSBudWxsXG4gICAgKSB7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIGlmIChldmVudC50YXJnZXQudmFsdWUgKyBpID09IFwieDBcIikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBgZGl2W3ZhbHVlPVwiJHtldmVudC50YXJnZXQudmFsdWUgKyBpfVwiXWBcbiAgICApLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yO1xuICAgIGNvb3JkaW5hdGUucHVzaChldmVudC50YXJnZXQudmFsdWUgKyBpKTtcbiAgfVxuICByZXR1cm4gY29vcmRpbmF0ZTtcbn1cbmNvbnN0IGdldENvbHVtbnMgPSAoc2hpcCk9PntcbiAgICBsZXQgY29sdW1ucyA9IFtdO1xuICAgIGZvcihsZXQgaSA9IDA7IGk8PXNoaXAubGVuZ3RoLTE7IGkrKyl7XG4gICAgICAgIFxuICAgICAgICAgIGlmKHNoaXAucG9zaXRpb25baV0pe1xuICAgICAgICAgICAgIGNvbHVtbnMucHVzaChNYXRoLmZsb29yKChzaGlwLnBvc2l0aW9uW2ldKS8xMCkpO1xuICAgICAgICB9ICBcbiAgICAgICAgXG4gICAgICAgXG4gICAgfVxuICBcbiAgICByZXR1cm4gY29sdW1ucztcbn1cbmNvbnN0IGNoYW5nZUNvbG9yID0gKCkgPT57XG4gICAgY29uc3Qgc2VsZWN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGxheWVyLWdyaWRzJykpO1xuICAgIHNlbGVjdC5maWx0ZXIoZWxlbWVudD0+ZWxlbWVudC52YWx1ZT09PSd4JykuZm9yRWFjaChlbGVtZW50PT5lbGVtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICd0cmFuc3BhcmVudCcpO1xuICAgIFxuICAgIFxufVxubGV0IGZsYWcgPSB0cnVlO1xuIGxldCBkaXJlY3Rpb24gPSAnaG9yaXpvbnRhbCc7XG4gbGV0IGluY3JlbWVudCA9IDE7XG4gY29uc3Qgcm90YXRlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3JvdGF0ZScpO1xuXG5leHBvcnQgY29uc3QgcmVuZGVyUGxheWVyU2hpcHMgPSAgIChnYW1lYm9hcmQsbGVuZ3RoLGFpQm9hcmQpID0+e1xuICAgICBcbiAgICBcbiAgICBcbiAgICBsZXQgZ3JpZHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGAucGxheWVyLWdyaWRzLiR7ZGlyZWN0aW9ufWApO1xuICAgIFxuICAgIFxuICAgIGNvbnN0IHNoaXAgPSBuZXcgU2hpcChsZW5ndGgsWzAsMCwwXSxbMSwyLDNdKTtcbiAgICBcbiAgICBpZihsZW5ndGg9PT0zKXtcbiAgICAgICAgaWYoZmxhZyl7XG4gICAgICAgICAgIGxlbmd0aCs9MTsgXG4gICAgICAgICAgIGZsYWc9ZmFsc2U7XG4gICAgICAgIH0gXG4gICAgfVxuICAgIGlmKGxlbmd0aDw9MSl7XG4gICAgICAgIGNvbnNvbGUubG9nKCdhbSBpIGV2ZXIgaGVyZT8/Pz8nKTtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhnYW1lYm9hcmQpO1xuICAgICAgXG4gICAgICAgIC8vICBsZXQgYWlIaXRzID0gcmVuZGVyQXR0YWNrKGdhbWVib2FyZCkuYWlCb2FyZC5oaXRzLmxlbmd0aDtcbiAgICAgICAgLy8gaWYoYWlIaXRzID09PSA1KXtcbiAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKCdwbGF5ZXIgd29uJyk7XG4gICAgICAgIC8vIH1cbiAgICAgICByZW5kZXJBdHRhY2soZ2FtZWJvYXJkKTtcbiAgICAgIFxuICAgICAgLy8gY29uc29sZS5sb2coJ2FpSGl0czonK2FpSGl0cyk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgICBcbiAgICBncmlkcy5mb3JFYWNoKGVsZW1lbnQ9PmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywoZSk9PntcbiAgICAgICAgICAgICBnZXRDb29yZGluYXRlcyhzaGlwLGUsJ2JsdWUnLGluY3JlbWVudCk7XG4gICAgICAgICAgICAgXG4gICAgICAgICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLChlKT0+e1xuICAgICAgICAgICAgICAgLy8gcmVuZGVyQWlTaGlwcyhhaUJvYXJkKVxuICAgICAgICAgICAgICAgY29uc29sZS5sb2coYWlCb2FyZCk7XG4gICAgICAgICAgICAgICBzaGlwLnBvc2l0aW9uID0gZ2V0Q29vcmRpbmF0ZXMoc2hpcCxlLCdncmF5JyxpbmNyZW1lbnQpO1xuICAgICAgICAgICAgICAgc2hpcC5jb2x1bW4gPSBnZXRDb2x1bW5zKHNoaXApO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICBnYW1lYm9hcmQucGxhY2VTaGlwKHNoaXApO1xuICAgICAgICAgICAgICAgICB1cGRhdGVCb2FyZChnYW1lYm9hcmQsJ3ByaW1hcnktY29udGFpbmVyJyxcInBsYXllci1ncmlkc1wiLGRpcmVjdGlvbik7XG4gICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgIGNoYW5nZUNvbG9yKCk7XG4gICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcmVuZGVyUGxheWVyU2hpcHMoZ2FtZWJvYXJkLGxlbmd0aC0xKTtcbiAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgXG4gICAgfSkpO1xuICAgIFxuXG4gICAgZ3JpZHMuZm9yRWFjaChlbGVtZW50PT5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3V0JywoZSk9PntcbiAgICAgICAgZ2V0Q29vcmRpbmF0ZXMoc2hpcCxlLCdncmF5JyxpbmNyZW1lbnQpO1xuICAgIH0pKTsgIFxuICAgIFxuICAgXG4gICBcbn1cblxuXG5leHBvcnQgY29uc3QgcmVuZGVyQXR0YWNrID0gKHBsYXllckJvYXJkKSA9PntcbiAgIGxldCBhaUJvYXJkID0gbmV3IEdhbWVCb2FyZCgpO1xuICAgIGxldCBhaTtcbiAgICBsZXQgcmFuZG9tbHlQaWNrZWRHcmlkO1xuICAgIGxldCBncmlkVmFsdWU7XG4gICAgY29uc3QgcGxheWVyR3JpZHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGxheWVyLWdyaWRzJyk7XG4gICAgY29uc3QgYWlHcmlkcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5haS1ncmlkcycpO1xuICAgXG4gICAgXG4gICAgXG4gICAgICAgIFxuICAgICAgICBhaUdyaWRzLmZvckVhY2goZWxlbWVudD0+ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsKGUpPT57XG4gICAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRWYWx1ZSA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZWxlbWVudDonK2VsZW1lbnRWYWx1ZSk7XG4gICAgICAgICAgICAgIGFpID0gbmV3IFBsYXllcigpO1xuICAgICAgICAgICAgICByYW5kb21seVBpY2tlZEdyaWQgPSBhaS5hdXRvUGxheShwbGF5ZXJHcmlkcyk7XG4gICAgICAgICAgICAgIGdyaWRWYWx1ZSA9IHJhbmRvbWx5UGlja2VkR3JpZC52YWx1ZTtcbiAgICAgICAgICAgICAgaWYoYWlCb2FyZC5oaXRzLmxlbmd0aCA9PT01KXtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncGxheWVyIHdvbiEnKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZihlbGVtZW50VmFsdWUgPT09ICd4Jyl7XG4gICAgICAgICAgICAgICAgYWlCb2FyZC5yZWNpZXZlQXR0YWNrKGVsZW1lbnRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAncmVkJztcbiAgICAgICAgICAgICAgICByZW5kZXJBaUF0dGFjayhyYW5kb21seVBpY2tlZEdyaWQsZ3JpZFZhbHVlLHBsYXllckJvYXJkKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnaGl0czonKyBhaUJvYXJkLmhpdHMubGVuZ3RoKTtcbiAgICAgICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICdncmVlbic7XG4gICAgICAgICAgICAgICAgcmVuZGVyQWlBdHRhY2socmFuZG9tbHlQaWNrZWRHcmlkLGdyaWRWYWx1ZSxwbGF5ZXJCb2FyZCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgfSkpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJue2FpQm9hcmR9XG4gICAgXG4gICAgfVxuY29uc3QgcmVuZGVyQWlBdHRhY2sgPSAocmFuZG9tbHlQaWNrZWRHcmlkLGdyaWRWYWx1ZSxwbGF5ZXJCb2FyZCk9PntcbiAgICByYW5kb21seVBpY2tlZEdyaWQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLChlKT0+e1xuICAgICAgICBjb25zdCBlbGVtZW50VmFsdWUgPSBlLnRhcmdldC52YWx1ZTtcbiAgICAgICAgaWYoZ3JpZFZhbHVlPT09ICd4Jyl7XG4gICAgICAgICAgICBwbGF5ZXJCb2FyZC5yZWNpZXZlQXR0YWNrKGdyaWRWYWx1ZSk7XG4gICAgICAgICAgICByYW5kb21seVBpY2tlZEdyaWQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ3JlZCc7XG4gICAgICAgICAgICBwbGF5ZXJCb2FyZC5yZWNpZXZlQXR0YWNrKGVsZW1lbnRWYWx1ZSlcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhaSByZWQnKTtcblxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIC8vIHJhbmRvbWx5UGlja2VkR3JpZC5jbGFzc0xpc3QuYWRkKCdncmVlbicpO1xuICAgICAgICAgICAgIHJhbmRvbWx5UGlja2VkR3JpZC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnZ3JlZW4nO1xuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhyYW5kb21seVBpY2tlZEdyaWQpO1xuICAgICAgICB9XG4gICAgIH0pO1xuICAgICAgY29uc3QgZXZlbnQgPSBuZXcgRXZlbnQoJ2NsaWNrJyk7XG4gICAgIHJhbmRvbWx5UGlja2VkR3JpZC5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcbn1cblxuZXhwb3J0IGNvbnN0IHJlbmRlclBsYXllckF0dGFjayA9IChib2FyZCk9PntcbiAgICBjb25zdCBhaUdyaWRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmFpLWdyaWRzJyk7XG4gICAgYWlHcmlkcy5mb3JFYWNoKGVsZW1lbnQ9PmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLChlKT0+e1xuICAgICAgICBpZihlLnRhcmdldC52YWx1ZSA9PT0gJ3gnKXtcbiAgICAgICAgICAgIGJvYXJkLnJlY2lldmVBdHRhY2soZS50YXJnZXQudmFsdWUpO1xuICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAncmVkJztcbiAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnZ3JlZW4nO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgIH0pKTtcbn1cblxuIHJvdGF0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsKGUpPT57XG4gICAgICBcbiAgICAgICAgaWYoZGlyZWN0aW9uID09PSdob3Jpem9udGFsJyl7XG4gICAgICAgICAgICBkaXJlY3Rpb24gPSAndmVydGljYWwnO1xuICAgICAgICAgICAgaW5jcmVtZW50ID0gMTA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIFxuICAgICAgICB9ZWxzZSBpZihkaXJlY3Rpb24gPT09J3ZlcnRpY2FsJyl7XG4gICAgICAgICAgICBkaXJlY3Rpb24gPSAnaG9yaXpvbnRhbCc7XG4gICAgICAgICAgICBpbmNyZW1lbnQgPSAxO1xuICAgICAgICAgICBcbiAgICAgICAgICAgIFxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBcbiAgICB9KTtcblxuXG5cblxuXG5leHBvcnQgY29uc3QgcmVuZGVyQWlTaGlwcyA9ICAoZ2FtZWJvYXJkKSA9PntcbiAgICBjb25zdCBzaGlwID0gbmV3IFNoaXAoNSxbMCwwLDAsMCwwXSxbMTAxLDEwMiwxMDMsMTA0LDEwNV0pO1xuICAgIGNvbnN0IHNoaXAyID0gbmV3IFNoaXAoNCxbNyw3LDcsN10sWzE3MywxNzQsMTc1LDE3Nl0pO1xuICAgIGNvbnN0IHNoaXAzID0gbmV3IFNoaXAoMyxbMiwyLDJdLFsxMjIsMTIzLDEyNF0pO1xuICAgIGNvbnN0IHNoaXA0ID0gbmV3IFNoaXAoMyxbNCw0LDRdLFsxNDQsMTQ1LDE0Nl0pO1xuICAgIGNvbnN0IHNoaXA1ID0gbmV3IFNoaXAoMixbOCw5XSxbMTgxLDE5MV0pO1xuICAgIFxuICAgIGdhbWVib2FyZC5wbGFjZVNoaXAoc2hpcCk7XG4gICAgdXBkYXRlQm9hcmQoZ2FtZWJvYXJkLCdzZWNvbmRhcnktY29udGFpbmVyJyxcImFpLWdyaWRzXCIsXCJob3Jpem9udGFsXCIpO1xuICAgIGdhbWVib2FyZC5wbGFjZVNoaXAoc2hpcDIpO1xuICAgIHVwZGF0ZUJvYXJkKGdhbWVib2FyZCwnc2Vjb25kYXJ5LWNvbnRhaW5lcicsXCJhaS1ncmlkc1wiLFwiaG9yaXpvbnRhbFwiKTtcbiAgICBnYW1lYm9hcmQucGxhY2VTaGlwKHNoaXAzKTtcbiAgICB1cGRhdGVCb2FyZChnYW1lYm9hcmQsJ3NlY29uZGFyeS1jb250YWluZXInLFwiYWktZ3JpZHNcIixcImhvcml6b250YWxcIik7XG4gICAgZ2FtZWJvYXJkLnBsYWNlU2hpcChzaGlwNCk7XG4gICAgdXBkYXRlQm9hcmQoZ2FtZWJvYXJkLCdzZWNvbmRhcnktY29udGFpbmVyJyxcImFpLWdyaWRzXCIsXCJob3Jpem9udGFsXCIpO1xuICAgIGdhbWVib2FyZC5wbGFjZVNoaXAoc2hpcDUpO1xuICAgIHVwZGF0ZUJvYXJkKGdhbWVib2FyZCwnc2Vjb25kYXJ5LWNvbnRhaW5lcicsXCJhaS1ncmlkc1wiLFwiaG9yaXpvbnRhbFwiKTtcbiAgICBcbn1cblxuXG5cbiIsImltcG9ydCBHYW1lQm9hcmQgZnJvbSBcIi4uL2ZhY3Rvcmllcy9HYW1lQm9hcmRcIjtcbmltcG9ydCB7IFBsYXllciB9IGZyb20gXCIuLi9mYWN0b3JpZXMvUGxheWVyXCJcbmltcG9ydCBTaGlwIGZyb20gXCIuLi9mYWN0b3JpZXMvU2hpcFwiO1xuaW1wb3J0IHsgY2xpY2tFdmVudCwgY3JlYXRlQm9hcmQsIHJlbW92ZUJvYXJkLCByZW5kZXJBaVNoaXBzLCByZW5kZXJBdHRhY2ssIHJlbmRlclBsYXllclNoaXBzLCB1cGRhdGVCb2FyZCAsIHJlbmRlckFpQXR0YWNrfSBmcm9tIFwiLi9kb21cIjtcblxuZXhwb3J0IGNvbnN0IHJ1bkdhbWUgPSAoKT0+e1xuICAgIGNvbnN0IHBsYXllciA9IG5ldyBQbGF5ZXIoKTtcbiAgICBjb25zdCBhaSA9IG5ldyBQbGF5ZXIoKTtcbiAgIFxuXG4gICAgY29uc3QgcGxheWVyQm9hcmQgPSBuZXcgR2FtZUJvYXJkKCk7XG4gICAgY29uc3QgYWlCb2FyZCA9IG5ldyBHYW1lQm9hcmQoKTtcbiAgICBwbGF5ZXJCb2FyZC5pbml0aWFsaXplKDApO1xuICAgIGFpQm9hcmQuaW5pdGlhbGl6ZSgxMDApO1xuICAgIFxuICAgIGNyZWF0ZUJvYXJkKHBsYXllckJvYXJkLCcjcHJpbWFyeS1jb250YWluZXInLCdwbGF5ZXItZ3JpZHMnLCdob3Jpem9udGFsJyk7XG4gICAgY3JlYXRlQm9hcmQoYWlCb2FyZCwnI3NlY29uZGFyeS1jb250YWluZXInLCdhaS1ncmlkcycsJ2hvcml6b250YWwnKTtcbiAgICAvL2NvbnNvbGUubG9nKGFpQm9hcmQpO1xuICAgIHJlbmRlckFpU2hpcHMoYWlCb2FyZCk7XG4gICAgLy9jb25zb2xlLmxvZyhhaUJvYXJkKTtcbiAgICByZW5kZXJQbGF5ZXJTaGlwcyhwbGF5ZXJCb2FyZCw1LGFpQm9hcmQpOyBcbiAgLy8gIGNvbnNvbGUubG9nKGFpQm9hcmQpO1xuICAgICAgIFxuICAgIC8vICByZW5kZXJBdHRhY2soYWlCb2FyZCxwbGF5ZXJCb2FyZCk7XG4gICAgXG4gICBcbiAgICBcbiAgICAvLyByZW5kZXJTaGlwcyhnYW1lYm9hcmQsNCk7XG4gICAvLyB1cGRhdGVCb2FyZChnYW1lYm9hcmQsJ3ByaW1hcnktY29udGFpbmVyJyxcInBsYXllci1ncmlkc1wiKTtcbiAgICAgXG4gICAgLy8gZm9yKGxldCBpID0wO2k8NDsgaSsrKXtcbiAgICAgICBcbiAgICAvLyAgICAgcmVuZGVyU2hpcHMoZ2FtZWJvYXJkLDQpO1xuICAgIC8vIH1cbiAgICAgXG4gICAgXG5cbiAgIFxuICAgIC8vICBjb25zb2xlLmxvZyhnYW1lYm9hcmQuYm9hcmQpO1xuICAgIC8vICBjbGlja0V2ZW50KHBsYXllcixhaSk7XG59XG5ydW5HYW1lKCk7Il0sIm5hbWVzIjpbIkdhbWVCb2FyZCIsImNvbnN0cnVjdG9yIiwiYm9hcmQiLCJ0aGlzIiwibWlzc2VkIiwiaGl0cyIsImFsbG93IiwiaW5pdGlhbGl6ZSIsImNvdW50IiwiaSIsImoiLCJwbGFjZVNoaXAiLCJzaGlwIiwiY29sdW1uIiwicG9zaXRpb24iLCJsZW5ndGgiLCJpbmRleE9mIiwicmVjaWV2ZUF0dGFjayIsInB1c2giLCJhbGxvd0F0dGFjayIsIlBsYXllciIsInR1cm4iLCJhdXRvUGxheSIsImdyaWQiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJTaGlwIiwiaGl0IiwiaGl0UG9zaXRpb24iLCJpc1N1bmsiLCJjcmVhdGVCb2FyZCIsIm5ld0JvYXJkIiwiaWQiLCJjbGFzc05hbWUiLCJkaXJlY3Rpb24iLCJjb250YWluZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJmb3JFYWNoIiwiZSIsImRpdiIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJzZXRBdHRyaWJ1dGUiLCJhcHBlbmRDaGlsZCIsInZhbHVlIiwidGV4dENvbnRlbnQiLCJ1cGRhdGVCb2FyZCIsImNvbnRhaW5lcklEIiwiZ3JpZElEIiwicmVtb3ZlQm9hcmQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZWxlbWVudCIsInJlbW92ZUNoaWxkIiwiY2hlY2tJZk91dE9mQm91bmQiLCJldmVudCIsImluY3JlbWVudCIsIm91dE9mQm91bmQ1Iiwib3V0T2ZCb3VuZDQiLCJvdXRPZkJvdW5kMyIsIm91dE9mQm91bmQyIiwiaW5jbHVkZXMiLCJ0YXJnZXQiLCJnZXRDb29yZGluYXRlcyIsImNvbG9yIiwiY29vcmRpbmF0ZSIsInN0eWxlIiwiYmFja2dyb3VuZENvbG9yIiwiZmxhZyIsInJvdGF0ZUJ1dHRvbiIsInJlbmRlclBsYXllclNoaXBzIiwiZ2FtZWJvYXJkIiwiYWlCb2FyZCIsImdyaWRzIiwiY29uc29sZSIsImxvZyIsInJlbmRlckF0dGFjayIsImFkZEV2ZW50TGlzdGVuZXIiLCJjb2x1bW5zIiwiZ2V0Q29sdW1ucyIsIkFycmF5IiwiZnJvbSIsImZpbHRlciIsInBsYXllckJvYXJkIiwiYWkiLCJyYW5kb21seVBpY2tlZEdyaWQiLCJncmlkVmFsdWUiLCJwbGF5ZXJHcmlkcyIsImVsZW1lbnRWYWx1ZSIsInJlbmRlckFpQXR0YWNrIiwiRXZlbnQiLCJkaXNwYXRjaEV2ZW50Iiwic2hpcDIiLCJzaGlwMyIsInNoaXA0Iiwic2hpcDUiLCJyZW5kZXJBaVNoaXBzIiwicnVuR2FtZSJdLCJzb3VyY2VSb290IjoiIn0=