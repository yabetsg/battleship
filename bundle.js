(()=>{"use strict";class e{constructor(){this.turn=!0,this.position=this.position}autoPlay(e){return e[Math.floor(10*Math.random())]}}class t{constructor(e,t,r){this.length=e,this.hits=[],this.position=r||[],this.column=t||[]}hit(e){this.hits.push(e)}isSunk(){return this.length===this.hits.length}}const r=(e,t,r,l)=>{const a=document.querySelector(t);let n=e.board;console.log(n),n.forEach((e=>{e.forEach((e=>{const t=document.createElement("div");t.classList.add(r),t.classList.add(l),t.setAttribute("value",e),a.appendChild(t),t.value=e,t.textContent=e}))}))},l=(e,t,r,l)=>{a(t,r);const n=document.querySelector(`#${t}`);e.board.forEach((e=>{e.forEach((e=>{const t=document.createElement("div");t.classList.add(r),t.classList.add(l),t.setAttribute("value",e),n.appendChild(t),t.value=e,t.textContent=e}))}))},a=(e,t)=>{const r=document.querySelector(`#${e}`);document.querySelectorAll(`.${t}`).forEach((e=>{r.removeChild(e)}))},n=(e,t,r)=>{let l=[6,7,8,9],a=[7,8,9],n=[8,9],o=[9];if(1===r)switch(!0){case 5===e.length&&l.includes(t.target.value%10):case 4===e.length&&a.includes(t.target.value%10):case 3===e.length&&n.includes(t.target.value%10):case 2===e.length&&o.includes(t.target.value%10):return!0}if(10===r)switch(!0){case 5===e.length&&l.includes(Math.floor(t.target.value/10)):case 4===e.length&&a.includes(Math.floor(t.target.value/10)):case 3===e.length&&n.includes(Math.floor(t.target.value/10)):case 2===e.length&&o.includes(Math.floor(t.target.value/10)):return!0}},o=(e,t,r,l)=>{let a=[];if(1!==e.length){for(let o=0;o<=(e.length-1)*l;o+=l){if(n(e,t,l))return;if(5===e.length&&t.target.value%10==6)return;if(t.target.value+o=="x0")return;if(null===document.querySelector(`div[value="${t.target.value+o}"]`))return;if(t.target.value+o=="x0")return;document.querySelector(`div[value="${t.target.value+o}"]`).style.backgroundColor=r,a.push(t.target.value+o)}return a}};let i=!0,c="horizontal",s=1;const u=document.querySelector("#rotate"),d=(e,r)=>{let a=document.querySelectorAll(`.player-grids.${c}`);const n=new t(r,[0,0,0],[1,2,3]);3===r&&i&&(r+=1,i=!1),r<=0||(a.forEach((t=>t.addEventListener("mouseover",(a=>{o(n,a,"blue",s),t.addEventListener("click",(t=>{n.position=o(n,t,"gray",s),n.column=(e=>{let t=[];for(let r=0;r<=e.length-1;r++)e.position[r]&&t.push(Math.floor(e.position[r]/10));return t})(n),e.placeShip(n),l(e,"primary-container","player-grids",c),Array.from(document.querySelectorAll(".player-grids")).filter((e=>"x"===e.value)).forEach((e=>e.style.backgroundColor="transparent")),d(e,r-1)}))})))),a.forEach((e=>e.addEventListener("mouseout",(e=>{o(n,e,"gray",s)})))))};let h=!0;u.addEventListener("click",(e=>{"horizontal"===c?(c="vertical",s=10):"vertical"===c&&(c="horizontal",s=1)}));class g{constructor(e){this.board=e||[],this.missed=[[]],this.hits=[]}initialize(e){for(let t=0;t<10;t++){this.board[t]=[];for(let r=0;r<10;r++)this.board[t][r]=e,e++}}placeShip(e){let t=e.column,r=e.position;for(let e=0;e<r.length;e++)for(let l=0;l<r.length;l++)this.board[t[e]][this.board[t[e]].indexOf(r[l])]="x"}recieveAttack(e){this.hits.push(e)}}(()=>{new e,new e;const a=new g,n=new g;a.initialize(0),n.initialize(100),r(a,"#primary-container","player-grids","horizontal"),r(n,"#secondary-container","ai-grids","x"),d(a,5),(e=>{const r=new t(5,[0,0,0,0,0],[101,102,103,104,105]),a=new t(4,[7,7,7,7],[173,174,175,176]),n=new t(3,[2,2,2],[122,123,124]),o=new t(3,[4,4,4],[144,145,146]),i=new t(2,[8,9],[181,191]);e.placeShip(r),e.placeShip(a),e.placeShip(n),e.placeShip(o),e.placeShip(i),l(e,"secondary-container","ai-grids")})(n),((t,r)=>{let l;const a=new e,n=document.querySelectorAll(".player-grids");let o,i=a.autoPlay(n);const c=document.querySelectorAll(".ai-grids"),s=new Event("click");c.forEach((r=>r.addEventListener("click",(a=>{l=new e,i=l.autoPlay(n),o=i.value,"x"===a.target.value?(t.recieveAttack(a.target.value),r.style.backgroundColor="red",i.dispatchEvent(s)):(r.style.backgroundColor="green",i.dispatchEvent(s))})))),i.addEventListener("click",(e=>{console.log("inside ai"),"x"===o?(r.recieveAttack(o),i.style.backgroundColor="red",h=!1,a.turn=!0):i.style.backgroundColor="green"}))})(n,a)})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBZWQsRUFBUUQsRUFBWSxFQWdCdkNnQixFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9mYWN0b3JpZXMvUGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZmFjdG9yaWVzL1NoaXAuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9zY3JpcHRzL2RvbS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2ZhY3Rvcmllcy9HYW1lQm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9zY3JpcHRzL21haW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNsYXNzIFBsYXllcntcbiAgICBjb25zdHJ1Y3RvcigpeyBcbiAgICAgICAgdGhpcy50dXJuID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IHRoaXMucG9zaXRpb247XG4gICAgfVxuICBcbiAgICBhdXRvUGxheShncmlkKXtcbiAgICAgICAgXG4gICAgICAgIGxldCByYW5kb20gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMTApO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGdyaWRbcmFuZG9tXTtcbiAgICB9XG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2hpcHtcbiAgICBjb25zdHJ1Y3RvcihsZW5ndGgsY29sdW1uLHBvc2l0aW9uKXtcbiAgICAgICAgdGhpcy5sZW5ndGggPSBsZW5ndGg7XG4gICAgICAgIHRoaXMuaGl0cyA9IFtdO1xuICAgICAgICB0aGlzLnBvc2l0aW9uID0gcG9zaXRpb258fFtdO1xuICAgICAgICB0aGlzLmNvbHVtbiA9IGNvbHVtbnx8W107XG4gICAgICAgXG4gICAgfVxuICAgIGhpdChoaXRQb3NpdGlvbil7XG4gICAgICAgIC8vIGlmKHRoaXMucG9zaXRpb24uaW5jbHVkZXMoaGl0UG9zaXRpb24pJiYgISh0aGlzLmhpdHMuaW5jbHVkZXMoaGl0UG9zaXRpb24pKSl7XG4gICAgICAgICAgICB0aGlzLmhpdHMucHVzaChoaXRQb3NpdGlvbik7XG4gICAgICAgIC8vfVxuICAgICAgICBcbiAgICB9XG5cbiAgICBpc1N1bmsoKXtcbiAgICAgICAgaWYodGhpcy5sZW5ndGggPT09IHRoaXMuaGl0cy5sZW5ndGgpe1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cblxuIiwiaW1wb3J0IEdhbWVCb2FyZCBmcm9tIFwiLi4vZmFjdG9yaWVzL0dhbWVCb2FyZFwiO1xuaW1wb3J0IHsgUGxheWVyIH0gZnJvbSBcIi4uL2ZhY3Rvcmllcy9QbGF5ZXJcIjtcbmltcG9ydCBTaGlwIGZyb20gXCIuLi9mYWN0b3JpZXMvU2hpcFwiO1xuXG5cbi8vIFRPRE86IEZpeCBzaGlwIGlzc3VlIHdoZXJlIHNoaXAgcGxhY2VtZW50IG92ZXJsYXBcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUJvYXJkID0gKG5ld0JvYXJkLGlkLGNsYXNzTmFtZSxkaXJlY3Rpb24pPT57XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihpZCk7XG4gICAgXG4gICAgbGV0IGJvYXJkID0gbmV3Qm9hcmQuYm9hcmQ7XG4gICAgY29uc29sZS5sb2coYm9hcmQpO1xuICAgIGJvYXJkLmZvckVhY2goZT0+e1xuICAgICAgICBlLmZvckVhY2goZT0+e1xuICAgICAgICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBkaXYuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpOyBcbiAgICAgICAgICAgIGRpdi5jbGFzc0xpc3QuYWRkKGRpcmVjdGlvbik7IFxuICAgICAgICAgICAgZGl2LnNldEF0dHJpYnV0ZSgndmFsdWUnLGUpO1xuICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdik7XG4gICAgICAgICAgICBkaXYudmFsdWUgPSBlO1xuICAgICAgICAgICAgZGl2LnRleHRDb250ZW50ID0gZTtcbiAgICAgICAgICAgIFxuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydCBjb25zdCB1cGRhdGVCb2FyZCA9IChuZXdCb2FyZCxjb250YWluZXJJRCxncmlkSUQsZGlyZWN0aW9uKT0+e1xuICAgIHJlbW92ZUJvYXJkKGNvbnRhaW5lcklELGdyaWRJRCk7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgIyR7Y29udGFpbmVySUR9YCk7XG4gICAgbGV0IGJvYXJkID0gbmV3Qm9hcmQuYm9hcmQ7XG4gICAgYm9hcmQuZm9yRWFjaChlPT57XG4gICAgICAgIGUuZm9yRWFjaChlPT57XG4gICAgICAgICAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGRpdi5jbGFzc0xpc3QuYWRkKGdyaWRJRCk7IFxuICAgICAgICAgICBkaXYuY2xhc3NMaXN0LmFkZChkaXJlY3Rpb24pOyBcbiAgICAgICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJyxlKTtcbiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXYpO1xuICAgICAgICAgICAgZGl2LnZhbHVlID0gZTtcbiAgICAgICAgICAgIGRpdi50ZXh0Q29udGVudCA9IGU7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIFxuICAgICAgICB9KTtcbiAgICAgICAgIFxuICAgIH0pO1xuXG4gICAgXG59XG5leHBvcnQgY29uc3QgcmVtb3ZlQm9hcmQgPSAoY29udGFpbmVySUQsZ3JpZElEKT0+e1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2NvbnRhaW5lcklEfWApO1xuICAgIGNvbnN0IGdyaWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGAuJHtncmlkSUR9YCk7XG4gICAgZ3JpZC5mb3JFYWNoKGVsZW1lbnQ9PiB7IFxuICAgICAgICAgICAgXG4gICAgICAgICBjb250YWluZXIucmVtb3ZlQ2hpbGQoZWxlbWVudClcbiAgICAgIFxuICAgICAgIFxuICAgIH0pO1xufVxuZXhwb3J0IGNvbnN0IGNsaWNrRXZlbnQgPSAocGxheWVyLGFpKT0+e1xuICAgIGNvbnN0IGdyaWRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmdyaWRzJyk7XG4gICAgZ3JpZHMuZm9yRWFjaChlbGVtZW50PT5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywoZSk9PntcbiAgICAgICAgaWYocGxheWVyLnR1cm4pe1xuICAgICAgICAgICAgIGFpLnR1cm4gPSB0cnVlO1xuICAgICAgICAgICAgIHBsYXllci50dXJuID0gZmFsc2U7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdwbGF5ZXI6ICcrZS50YXJnZXQudmFsdWUpO1xuICAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IEV2ZW50KCdjbGljaycpO1xuICAgICAgICAgICAgZWxlbWVudC5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcbiAgICAgICAgfWVsc2UgaWYoYWkudHVybil7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnYWk6ICcrIGFpLmF1dG9QbGF5KCkpO1xuICAgICAgICAgICAgYWkudHVybiA9IGZhbHNlO1xuICAgICAgICAgICAgcGxheWVyLnR1cm4gPSB0cnVlO1xuICAgICAgICAgICAgXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfSkpO1xufVxuXG5jb25zdCBjaGVja0lmT3V0T2ZCb3VuZCA9IChzaGlwLGV2ZW50LGluY3JlbWVudCk9PntcbiAgICBsZXQgb3V0T2ZCb3VuZDUgPSBbNiw3LDgsOV07XG4gICAgIGxldCBvdXRPZkJvdW5kNCA9IFs3LDgsOV07XG4gICAgIGxldCBvdXRPZkJvdW5kMyA9IFs4LDldO1xuICAgICBsZXQgb3V0T2ZCb3VuZDIgPSBbOV07XG4gICAgXG4gICAgaWYoaW5jcmVtZW50ID09PTEpe1xuICAgICAgICBzd2l0Y2godHJ1ZSl7IFxuICAgICAgICAgICAgIGNhc2Ugc2hpcC5sZW5ndGg9PT01ICYmIG91dE9mQm91bmQ1LmluY2x1ZGVzKGV2ZW50LnRhcmdldC52YWx1ZSUxMCk6XG4gICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgIGNhc2Ugc2hpcC5sZW5ndGg9PT00ICYmIG91dE9mQm91bmQ0LmluY2x1ZGVzKGV2ZW50LnRhcmdldC52YWx1ZSUxMCk6XG4gICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgIGNhc2Ugc2hpcC5sZW5ndGg9PT0zICYmIG91dE9mQm91bmQzLmluY2x1ZGVzKGV2ZW50LnRhcmdldC52YWx1ZSUxMCk6XG4gICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgIGNhc2Ugc2hpcC5sZW5ndGg9PT0yICYmIG91dE9mQm91bmQyLmluY2x1ZGVzKGV2ZW50LnRhcmdldC52YWx1ZSUxMCk6XG4gICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBcbiAgICAgfVxuICAgICBpZihpbmNyZW1lbnQgPT09MTApe1xuICAgICAgICAgc3dpdGNoKHRydWUpeyBcbiAgICAgICAgICAgICAgY2FzZSBzaGlwLmxlbmd0aD09PTUgJiYgb3V0T2ZCb3VuZDUuaW5jbHVkZXMoTWF0aC5mbG9vcihldmVudC50YXJnZXQudmFsdWUvMTApKTpcbiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICBjYXNlIHNoaXAubGVuZ3RoPT09NCAmJiBvdXRPZkJvdW5kNC5pbmNsdWRlcyhNYXRoLmZsb29yKGV2ZW50LnRhcmdldC52YWx1ZS8xMCkpOlxuICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgIGNhc2Ugc2hpcC5sZW5ndGg9PT0zICYmIG91dE9mQm91bmQzLmluY2x1ZGVzKE1hdGguZmxvb3IoZXZlbnQudGFyZ2V0LnZhbHVlLzEwKSk6XG4gICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgY2FzZSBzaGlwLmxlbmd0aD09PTIgJiYgb3V0T2ZCb3VuZDIuaW5jbHVkZXMoTWF0aC5mbG9vcihldmVudC50YXJnZXQudmFsdWUvMTApKTpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgfSBcbiAgICAgIH1cbn1cbmNvbnN0IGdldENvb3JkaW5hdGVzID0gKHNoaXAsZXZlbnQsY29sb3IsaW5jcmVtZW50KT0+e1xuICBcblxuICBsZXQgY29vcmRpbmF0ZSA9IFtdO1xuICBpZiAoc2hpcC5sZW5ndGggPT09IDEpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgZm9yIChsZXQgaSA9IDA7IGkgPD0gKHNoaXAubGVuZ3RoIC0gMSkgKiBpbmNyZW1lbnQ7IGkgPSBpICsgaW5jcmVtZW50KSB7XG4gICAgIGlmKGNoZWNrSWZPdXRPZkJvdW5kKHNoaXAsZXZlbnQsaW5jcmVtZW50KSkgcmV0dXJuO1xuICAgXG4gICAgaWYgKHNoaXAubGVuZ3RoID09PSA1KSB7XG4gICAgICBpZiAoZXZlbnQudGFyZ2V0LnZhbHVlICUgMTAgPT09IDYpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoZXZlbnQudGFyZ2V0LnZhbHVlICsgaSA9PSBcIngwXCIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgZGl2W3ZhbHVlPVwiJHtldmVudC50YXJnZXQudmFsdWUgKyBpfVwiXWApID09PSBudWxsXG4gICAgKSB7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIGlmIChldmVudC50YXJnZXQudmFsdWUgKyBpID09IFwieDBcIikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBgZGl2W3ZhbHVlPVwiJHtldmVudC50YXJnZXQudmFsdWUgKyBpfVwiXWBcbiAgICApLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yO1xuICAgIGNvb3JkaW5hdGUucHVzaChldmVudC50YXJnZXQudmFsdWUgKyBpKTtcbiAgfVxuICByZXR1cm4gY29vcmRpbmF0ZTtcbn1cbmNvbnN0IGdldENvbHVtbnMgPSAoc2hpcCk9PntcbiAgICBsZXQgY29sdW1ucyA9IFtdO1xuICAgIGZvcihsZXQgaSA9IDA7IGk8PXNoaXAubGVuZ3RoLTE7IGkrKyl7XG4gICAgICAgIFxuICAgICAgICAgIGlmKHNoaXAucG9zaXRpb25baV0pe1xuICAgICAgICAgICAgIGNvbHVtbnMucHVzaChNYXRoLmZsb29yKChzaGlwLnBvc2l0aW9uW2ldKS8xMCkpO1xuICAgICAgICB9ICBcbiAgICAgICAgXG4gICAgICAgIFxuXG4gICAgICAgXG4gICAgfVxuICBcbiAgICByZXR1cm4gY29sdW1ucztcbn1cbmNvbnN0IGNoYW5nZUNvbG9yID0gKCkgPT57XG4gICAgY29uc3Qgc2VsZWN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGxheWVyLWdyaWRzJykpO1xuICAgIHNlbGVjdC5maWx0ZXIoZWxlbWVudD0+ZWxlbWVudC52YWx1ZT09PSd4JykuZm9yRWFjaChlbGVtZW50PT5lbGVtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICd0cmFuc3BhcmVudCcpO1xuICAgIFxuICAgIFxufVxubGV0IGZsYWcgPSB0cnVlO1xuIGxldCBkaXJlY3Rpb24gPSAnaG9yaXpvbnRhbCc7XG4gbGV0IGluY3JlbWVudCA9IDE7XG4gY29uc3Qgcm90YXRlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3JvdGF0ZScpO1xuXG5leHBvcnQgY29uc3QgcmVuZGVyUGxheWVyU2hpcHMgPSAgKGdhbWVib2FyZCxsZW5ndGgpID0+e1xuICAgIFxuICAgXG4gICAgbGV0IGdyaWRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgLnBsYXllci1ncmlkcy4ke2RpcmVjdGlvbn1gKTtcbiAgICBcbiAgICBcbiAgICBjb25zdCBzaGlwID0gbmV3IFNoaXAobGVuZ3RoLFswLDAsMF0sWzEsMiwzXSk7XG4gICAgXG4gICAgaWYobGVuZ3RoPT09Myl7XG4gICAgICAgIGlmKGZsYWcpe1xuICAgICAgICAgICBsZW5ndGgrPTE7IFxuICAgICAgICAgICBmbGFnPWZhbHNlO1xuICAgICAgICB9IFxuICAgIH1cbiAgICBpZihsZW5ndGg8PTApe1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIGNvbnN0IGNoZWNrTmVhclNoaXBzID0oYm9hcmQsc2hpcCk9PntcbiAgICAvLyAgICAgbGV0IHBvc2l0aW9uID0gc2hpcC5wb3NpdGlvbjtcbiAgICAvLyAgICAgbGV0IGNvbHVtbiA9IHNoaXAuY29sdW1uO1xuICAgIC8vICAgICBmb3IobGV0IGkgPTA7IGk8c2hpcC5sZW5ndGg7aSsrKXtcbiAgICAvLyAgICAgICAgIGZvcihsZXQgaiA9IDA7IGo8c2hpcC5sZW5ndGg7aisrKXtcbiAgICAvLyAgICAgICAgICAgICBpZigoYm9hcmQuYm9hcmRbY29sdW1uW2ldXVtwb3NpdGlvbltqXV0pLmVxdWFscygneCcpKXtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgLy8gICAgICAgIH0gXG4gICAgICAgICAgIFxuICAgIC8vICAgICB9XG4gICAgLy8gICAgIH1cbiAgICAvLyB9XG4gICAgZ3JpZHMuZm9yRWFjaChlbGVtZW50PT5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsKGUpPT57XG4gICAgICAgICAgICAgZ2V0Q29vcmRpbmF0ZXMoc2hpcCxlLCdibHVlJyxpbmNyZW1lbnQpO1xuICAgICAgICAgICAgIFxuICAgICAgICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywoZSk9PntcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICBzaGlwLnBvc2l0aW9uID0gZ2V0Q29vcmRpbmF0ZXMoc2hpcCxlLCdncmF5JyxpbmNyZW1lbnQpO1xuICAgICAgICAgICAgICAgc2hpcC5jb2x1bW4gPSBnZXRDb2x1bW5zKHNoaXApO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICBnYW1lYm9hcmQucGxhY2VTaGlwKHNoaXApO1xuICAgICAgICAgICAgICAgICB1cGRhdGVCb2FyZChnYW1lYm9hcmQsJ3ByaW1hcnktY29udGFpbmVyJyxcInBsYXllci1ncmlkc1wiLGRpcmVjdGlvbik7XG4gICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICBjaGFuZ2VDb2xvcigpO1xuICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHJlbmRlclBsYXllclNoaXBzKGdhbWVib2FyZCxsZW5ndGgtMSk7XG4gICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgIFxuICAgIH0pKTtcbiAgICBcblxuICAgIGdyaWRzLmZvckVhY2goZWxlbWVudD0+ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW91dCcsKGUpPT57XG4gICAgICAgIGdldENvb3JkaW5hdGVzKHNoaXAsZSwnZ3JheScsaW5jcmVtZW50KTtcbiAgICB9KSk7ICBcbiAgICBcbiAgIFxuICAgXG59XG5leHBvcnQgY29uc3QgcmVuZGVyQXR0YWNrID0gKGJvYXJkLGFpLHBsYXllcik9PntcbiAgICBwbGF5ZXIudHVybiA9IHRydWU7XG4gICAgcmVuZGVyUGxheWVyQXR0YWNrKGJvYXJkLHBsYXllcik7XG4gICAgcmVuZGVyQWlBdHRhY2soYm9hcmQsYWkpO1xufVxubGV0IHR1cm4gPSB0cnVlO1xuZXhwb3J0IGNvbnN0IHJlbmRlckFpQXR0YWNrID0gKGFpQm9hcmQscGxheWVyQm9hcmQpID0+e1xuICAgIGxldCBhaTtcblxuICAgIGNvbnN0IHBsYXllciA9IG5ldyBQbGF5ZXIoKTtcbiAgICBcbiAgICBjb25zdCBwbGF5ZXJHcmlkcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wbGF5ZXItZ3JpZHMnKTtcbiAgIGxldCByYW5kb21seVBpY2tlZEdyaWQgPSBwbGF5ZXIuYXV0b1BsYXkocGxheWVyR3JpZHMpO1xuICAgIC8vIGNvbnN0IHJhbmRvbWx5UGlja2VkR3JpZCA9IGFpLmF1dG9QbGF5KHBsYXllckdyaWRzKTtcbiAgICBsZXQgZ3JpZFZhbHVlO1xuICAgIGNvbnN0IGFpR3JpZHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYWktZ3JpZHMnKTtcbiAgICBjb25zdCBldmVudCA9IG5ldyBFdmVudCgnY2xpY2snKTtcbiAgICAgICAgLy8gIGNvbnNvbGUubG9nKHJhbmRvbWx5UGlja2VkR3JpZCk7XG4gICAgXG4gICAgICAgIFxuICAgICAgICBhaUdyaWRzLmZvckVhY2goZWxlbWVudD0+ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsKGUpPT57XG4gICAgICAgICAgICAgYWkgPSBuZXcgUGxheWVyKCk7XG4gICAgICAgICAgICAgIHJhbmRvbWx5UGlja2VkR3JpZCA9IGFpLmF1dG9QbGF5KHBsYXllckdyaWRzKTtcbiAgICAgICAgICAgICAgZ3JpZFZhbHVlID0gcmFuZG9tbHlQaWNrZWRHcmlkLnZhbHVlO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZihlLnRhcmdldC52YWx1ZSA9PT0gJ3gnKXtcbiAgICAgICAgICAgICAgICBhaUJvYXJkLnJlY2lldmVBdHRhY2soZS50YXJnZXQudmFsdWUpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ3JlZCc7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHJhbmRvbWx5UGlja2VkR3JpZC5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcbiAgICAgICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICdncmVlbic7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcmFuZG9tbHlQaWNrZWRHcmlkLmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgIH0pKTtcbiAgICAgICAgXG4vL1RPRE86ICEhIEZpeCB2XG4gICAgICAgICBcbiAgICAgICByYW5kb21seVBpY2tlZEdyaWQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLChlKT0+e1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coJ2luc2lkZSBhaScpO1xuICAgICAgICBpZihncmlkVmFsdWU9PT0gJ3gnKXtcbiAgICAgICAgICAgIHBsYXllckJvYXJkLnJlY2lldmVBdHRhY2soZ3JpZFZhbHVlKTtcbiAgICAgICAgICAgIHJhbmRvbWx5UGlja2VkR3JpZC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAncmVkJztcbiAgICAgICAgICAgIHR1cm4gPSBmYWxzZTtcbiAgICAgICAgICAgIHBsYXllci50dXJuID0gdHJ1ZTtcblxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHJhbmRvbWx5UGlja2VkR3JpZC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnZ3JlZW4nO1xuICAgICAgICB9XG4gICAgIH0pOyBcbiAgICBcbiAgICBcbiAgICB9XG4gICAgXG5cbmV4cG9ydCBjb25zdCByZW5kZXJQbGF5ZXJBdHRhY2sgPSAoYm9hcmQpPT57XG4gICAgY29uc3QgYWlHcmlkcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5haS1ncmlkcycpO1xuICAgIGFpR3JpZHMuZm9yRWFjaChlbGVtZW50PT5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywoZSk9PntcbiAgICAgICAgaWYoZS50YXJnZXQudmFsdWUgPT09ICd4Jyl7XG4gICAgICAgICAgICBib2FyZC5yZWNpZXZlQXR0YWNrKGUudGFyZ2V0LnZhbHVlKTtcbiAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ3JlZCc7XG4gICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ2dyZWVuJztcbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9KSk7XG59XG5cbiByb3RhdGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLChlKT0+e1xuICAgICAgXG4gICAgICAgIGlmKGRpcmVjdGlvbiA9PT0naG9yaXpvbnRhbCcpe1xuICAgICAgICAgICAgZGlyZWN0aW9uID0gJ3ZlcnRpY2FsJztcbiAgICAgICAgICAgIGluY3JlbWVudCA9IDEwO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBcbiAgICAgICAgfWVsc2UgaWYoZGlyZWN0aW9uID09PSd2ZXJ0aWNhbCcpe1xuICAgICAgICAgICAgZGlyZWN0aW9uID0gJ2hvcml6b250YWwnO1xuICAgICAgICAgICAgaW5jcmVtZW50ID0gMTtcbiAgICAgICAgICAgXG4gICAgICAgICAgICBcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgXG4gICAgfSk7XG5cblxuXG5cblxuZXhwb3J0IGNvbnN0IHJlbmRlckFpU2hpcHMgPSAgKGdhbWVib2FyZCkgPT57XG4gICAgY29uc3Qgc2hpcCA9IG5ldyBTaGlwKDUsWzAsMCwwLDAsMF0sWzEwMSwxMDIsMTAzLDEwNCwxMDVdKTtcbiAgICBjb25zdCBzaGlwMiA9IG5ldyBTaGlwKDQsWzcsNyw3LDddLFsxNzMsMTc0LDE3NSwxNzZdKTtcbiAgICBjb25zdCBzaGlwMyA9IG5ldyBTaGlwKDMsWzIsMiwyXSxbMTIyLDEyMywxMjRdKTtcbiAgICBjb25zdCBzaGlwNCA9IG5ldyBTaGlwKDMsWzQsNCw0XSxbMTQ0LDE0NSwxNDZdKTtcbiAgICBjb25zdCBzaGlwNSA9IG5ldyBTaGlwKDIsWzgsOV0sWzE4MSwxOTFdKTtcbiAgICBcbiAgICBnYW1lYm9hcmQucGxhY2VTaGlwKHNoaXApO1xuICAgIGdhbWVib2FyZC5wbGFjZVNoaXAoc2hpcDIpO1xuICAgIGdhbWVib2FyZC5wbGFjZVNoaXAoc2hpcDMpO1xuICAgIGdhbWVib2FyZC5wbGFjZVNoaXAoc2hpcDQpO1xuICAgIGdhbWVib2FyZC5wbGFjZVNoaXAoc2hpcDUpO1xuICAgIHVwZGF0ZUJvYXJkKGdhbWVib2FyZCwnc2Vjb25kYXJ5LWNvbnRhaW5lcicsXCJhaS1ncmlkc1wiKTtcbn1cblxuXG5cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWVCb2FyZCB7XG4gIGNvbnN0cnVjdG9yKGJvYXJkKSB7XG4gICAgdGhpcy5ib2FyZCA9IGJvYXJkIHx8IFtdO1xuICAgIHRoaXMubWlzc2VkID0gW1tdXTtcbiAgICB0aGlzLmhpdHMgPSBbXTtcbiAgICBcbiAgfVxuXG4gIGluaXRpYWxpemUoY291bnQpIHtcbiAgICBcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgICAgIHRoaXMuYm9hcmRbaV0gPSBbXTtcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGorKykge1xuICAgICAgICB0aGlzLmJvYXJkW2ldW2pdID0gY291bnQ7XG4gICAgICAgIGNvdW50Kys7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuXG5cbiAgcGxhY2VTaGlwKHNoaXApIHtcbiAgICBsZXQgY29sdW1uID0gc2hpcC5jb2x1bW47XG4gICAgbGV0IHBvc2l0aW9uID0gc2hpcC5wb3NpdGlvbjtcbiAgICBcbiAgIFxuICAgIGZvcihsZXQgaT0wOyBpPHBvc2l0aW9uLmxlbmd0aDtpKyspe1xuICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgcG9zaXRpb24ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgLy8gaWYoKHRoaXMuYm9hcmRbY29sdW1uW2ldKzFdW3RoaXMuYm9hcmRbY29sdW1uW2ldKzFdLmluZGV4T2YocG9zaXRpb25bal0rMTApXSkhPSd4Jyl7XG4gICAgICAgICAgdGhpcy5ib2FyZFtjb2x1bW5baV1dW3RoaXMuYm9hcmRbY29sdW1uW2ldXS5pbmRleE9mKHBvc2l0aW9uW2pdKV0gPSAneCc7XG4gICAgICAgIFxuICAgICAgICAvLyB9XG4gICAgfVxuICAgfVxuICAgXG4gIH1cbiAgXG4gXG4gXG4gIHJlY2lldmVBdHRhY2socG9zaXRpb24pe1xuICAgIFxuICAgICAgICB0aGlzLmhpdHMucHVzaChwb3NpdGlvbik7XG4gICAgXG4gIH1cblxuICBcblxuICAvLyByZWNpZXZlQXR0YWNrKGNvbHVtbiwgcG9zaXRpb24pIHtcbiAgLy8gICBmb3IobGV0IGk9MDsgaTxwb3NpdGlvbi5sZW5ndGg7IGkrKyl7XG4gIC8vICAgICBmb3IobGV0IGo9MDsgajxwb3NpdGlvbi5sZW5ndGg7IGorKyl7XG4gIC8vICAgICAgIGlmICh0aGlzLmJvYXJkW2NvbHVtbltpXV1bcG9zaXRpb25bal1dID09PSBcInhcIikge1xuICAvLyAgICAgICAgIGlmICh0aGlzLmhpdHNbY29sdW1uW2ldXSA9PT0gdW5kZWZpbmVkKSB7XG4gIC8vICAgICAgIHRoaXMuaGl0c1tjb2x1bW5baV1dID0gW3Bvc2l0aW9uW2pdXTtcbiAgLy8gICAgIH0gZWxzZSB7XG4gIC8vICAgICAgIHRoaXMuaGl0c1tjb2x1bW5baV1dLnB1c2gocG9zaXRpb25baV0pO1xuICAvLyAgICAgfVxuICAvLyAgIH0gZWxzZSBpZiAodGhpcy5taXNzZWRbY29sdW1uXSA9PT0gdW5kZWZpbmVkKSB7XG4gIC8vICAgICB0aGlzLm1pc3NlZFtjb2x1bW5dID0gW3Bvc2l0aW9uXTtcbiAgLy8gICB9IGVsc2Uge1xuICAvLyAgICAgdGhpcy5taXNzZWRbY29sdW1uXS5wdXNoKHBvc2l0aW9uKTtcbiAgLy8gICB9XG4gIC8vICAgICB9XG4gIC8vICAgfVxuICAgIFxuICAvLyB9XG4gXG59XG4iLCJpbXBvcnQgR2FtZUJvYXJkIGZyb20gXCIuLi9mYWN0b3JpZXMvR2FtZUJvYXJkXCI7XG5pbXBvcnQgeyBQbGF5ZXIgfSBmcm9tIFwiLi4vZmFjdG9yaWVzL1BsYXllclwiXG5pbXBvcnQgU2hpcCBmcm9tIFwiLi4vZmFjdG9yaWVzL1NoaXBcIjtcbmltcG9ydCB7IGNsaWNrRXZlbnQsIGNyZWF0ZUJvYXJkLCByZW1vdmVCb2FyZCwgcmVuZGVyQWlTaGlwcywgcmVuZGVyQXR0YWNrLCByZW5kZXJQbGF5ZXJTaGlwcywgdXBkYXRlQm9hcmQgLCByZW5kZXJBaUF0dGFja30gZnJvbSBcIi4vZG9tXCI7XG5cbmV4cG9ydCBjb25zdCBydW5HYW1lID0gKCk9PntcbiAgICBjb25zdCBwbGF5ZXIgPSBuZXcgUGxheWVyKCk7XG4gICAgY29uc3QgYWkgPSBuZXcgUGxheWVyKCk7XG4gICBcblxuICAgIGNvbnN0IHBsYXllckJvYXJkID0gbmV3IEdhbWVCb2FyZCgpO1xuICAgIGNvbnN0IGFpQm9hcmQgPSBuZXcgR2FtZUJvYXJkKCk7XG4gICAgcGxheWVyQm9hcmQuaW5pdGlhbGl6ZSgwKTtcbiAgICBhaUJvYXJkLmluaXRpYWxpemUoMTAwKTtcbiAgICBjcmVhdGVCb2FyZChwbGF5ZXJCb2FyZCwnI3ByaW1hcnktY29udGFpbmVyJywncGxheWVyLWdyaWRzJywnaG9yaXpvbnRhbCcpO1xuICAgIGNyZWF0ZUJvYXJkKGFpQm9hcmQsJyNzZWNvbmRhcnktY29udGFpbmVyJywnYWktZ3JpZHMnLCd4Jyk7XG4gICAgIHJlbmRlclBsYXllclNoaXBzKHBsYXllckJvYXJkLDUpOyBcbiAgICByZW5kZXJBaVNoaXBzKGFpQm9hcmQpO1xuICAgXG4gICAgcmVuZGVyQWlBdHRhY2soYWlCb2FyZCxwbGF5ZXJCb2FyZCk7XG4gICAgXG4gICAgLy8gcmVuZGVyU2hpcHMoZ2FtZWJvYXJkLDQpO1xuICAgLy8gdXBkYXRlQm9hcmQoZ2FtZWJvYXJkLCdwcmltYXJ5LWNvbnRhaW5lcicsXCJwbGF5ZXItZ3JpZHNcIik7XG4gICAgIFxuICAgIC8vIGZvcihsZXQgaSA9MDtpPDQ7IGkrKyl7XG4gICAgICAgXG4gICAgLy8gICAgIHJlbmRlclNoaXBzKGdhbWVib2FyZCw0KTtcbiAgICAvLyB9XG4gICAgIFxuICAgIFxuXG4gICBcbiAgICAvLyAgY29uc29sZS5sb2coZ2FtZWJvYXJkLmJvYXJkKTtcbiAgICAvLyAgY2xpY2tFdmVudChwbGF5ZXIsYWkpO1xufVxucnVuR2FtZSgpOyJdLCJuYW1lcyI6WyJQbGF5ZXIiLCJjb25zdHJ1Y3RvciIsInRoaXMiLCJ0dXJuIiwicG9zaXRpb24iLCJhdXRvUGxheSIsImdyaWQiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJTaGlwIiwibGVuZ3RoIiwiY29sdW1uIiwiaGl0cyIsImhpdCIsImhpdFBvc2l0aW9uIiwicHVzaCIsImlzU3VuayIsImNyZWF0ZUJvYXJkIiwibmV3Qm9hcmQiLCJpZCIsImNsYXNzTmFtZSIsImRpcmVjdGlvbiIsImNvbnRhaW5lciIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImJvYXJkIiwiY29uc29sZSIsImxvZyIsImZvckVhY2giLCJlIiwiZGl2IiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsInNldEF0dHJpYnV0ZSIsImFwcGVuZENoaWxkIiwidmFsdWUiLCJ0ZXh0Q29udGVudCIsInVwZGF0ZUJvYXJkIiwiY29udGFpbmVySUQiLCJncmlkSUQiLCJyZW1vdmVCb2FyZCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJlbGVtZW50IiwicmVtb3ZlQ2hpbGQiLCJjaGVja0lmT3V0T2ZCb3VuZCIsInNoaXAiLCJldmVudCIsImluY3JlbWVudCIsIm91dE9mQm91bmQ1Iiwib3V0T2ZCb3VuZDQiLCJvdXRPZkJvdW5kMyIsIm91dE9mQm91bmQyIiwiaW5jbHVkZXMiLCJ0YXJnZXQiLCJnZXRDb29yZGluYXRlcyIsImNvbG9yIiwiY29vcmRpbmF0ZSIsImkiLCJzdHlsZSIsImJhY2tncm91bmRDb2xvciIsImZsYWciLCJyb3RhdGVCdXR0b24iLCJyZW5kZXJQbGF5ZXJTaGlwcyIsImdhbWVib2FyZCIsImdyaWRzIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNvbHVtbnMiLCJnZXRDb2x1bW5zIiwicGxhY2VTaGlwIiwiQXJyYXkiLCJmcm9tIiwiZmlsdGVyIiwiR2FtZUJvYXJkIiwibWlzc2VkIiwiaW5pdGlhbGl6ZSIsImNvdW50IiwiaiIsImluZGV4T2YiLCJyZWNpZXZlQXR0YWNrIiwicGxheWVyQm9hcmQiLCJhaUJvYXJkIiwic2hpcDIiLCJzaGlwMyIsInNoaXA0Iiwic2hpcDUiLCJyZW5kZXJBaVNoaXBzIiwiYWkiLCJwbGF5ZXIiLCJwbGF5ZXJHcmlkcyIsImdyaWRWYWx1ZSIsInJhbmRvbWx5UGlja2VkR3JpZCIsImFpR3JpZHMiLCJFdmVudCIsImRpc3BhdGNoRXZlbnQiLCJyZW5kZXJBaUF0dGFjayIsInJ1bkdhbWUiXSwic291cmNlUm9vdCI6IiJ9